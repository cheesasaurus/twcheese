!function(){let toolId="BRE";if(void 0===window.TwCheese){function handleJqXhrError(e){return function(t){e(new Error(`[${t.status} ${t.statusText}] ${this.type} ${this.url}`))}}window.TwCheese={ROOT:"https://cheesasaurus.github.io/twcheese",version:"1.10-1-g972349d",tools:{},lastToolUsedId:null,async loadVendorLibs(){return new Promise((e,t)=>{$.ajax(`${this.ROOT}/dist/vendor.js`,{complete:e,error:handleJqXhrError(t),dataType:"script"})})},async loadVendorLibsMinified(e){return new Promise((t,r)=>{$.ajax(`${this.ROOT}/dist/vendor.min.js?${e}`,{cache:!0,complete:t,error:handleJqXhrError(r),dataType:"script"})})},async loadTool(e){return new Promise(t=>{let r=document.createElement("script");r.type="module",r.onload=t,r.src=`${this.ROOT}/src/ToolSetup/${e}.js`,document.head.appendChild(r)})},async loadToolCompiled(e,t){return new Promise((r,n)=>{$.ajax(`${this.ROOT}/dist/tool/setup-only/${e}.min.js?${t}`,{cache:!0,complete:r,error:handleJqXhrError(n),dataType:"script"})})},hasTool(e){return void 0!==this.tools[e]},registerTool(e){this.tools[e.id]=e},useTool(e){this.lastToolUsedId=e,this.tools[e].use()},tryUseTool(e){return!!this.hasTool(e)&&(this.useTool(e),!0)},newDebugProcess(e){return this.hasTool(e)?this.tools[e].getDebugProcess():null}},function(){this.twcheeseExampleLib={nice:()=>69}}.call(window)}if(!TwCheese.hasTool(toolId)){let sidebarInitd=TwCheese.hasTool("Sidebar");!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}([function(e,t,r){"use strict";r.d(t,"a",function(){return s});let n=window.image_base,i=window.TwCheese.ROOT+"/assets/images/",s={plus:n+"plus.png",minus:n+"minus.png",wood:n+"holz.png",stone:n+"lehm.png",iron:n+"eisen.png",attack:n+"command/attack.png",haulPartial:n+"max_loot/0.png",haulFull:n+"max_loot/1.png",info:n+"questionmark.png",attackSentViaFa:n+"command/farm.png",attackSizeSmall:n+"command/attack_small.png",attackSizeMedium:n+"command/attack_medium.png",attackSizeLarge:n+"command/attack_large.png",attackContainsSnob:n+"command/snob.png",attackContainsSpy:n+"command/spy.png",attackContainsKnight:n+"command/knight.png",popupBackground:n+"popup/content_background.png",popupBorder:n+"popup/border.png",servant:n+"paladin_new.png",loadingSpinner:n+"throbber.gif",calendar:i+"calendar.png",sidebarMain:i+"sidebar/gear.png",sidebarBug:i+"sidebar/bug.png",sidebarGithub:i+"sidebar/github.png",jq:{blue:i+"jquery/ui-icons_2e83ff_256x240.png",black:i+"jquery/ui-icons_222222_256x240.png",darkGrey:i+"jquery/ui-icons_454545_256x240.png",grey:i+"jquery/ui-icons_888888_256x240.png",red:i+"jquery/ui-icons_cd0a0a_256x240.png"},legacy:{helpBackground:i+"legacy/help_background.png",helpBackgroundBright:i+"legacy/help_background_highlight.png"},buildingIcon:e=>n+`buildings/${e}.png`,troopIcon:e=>n+`unit/unit_${e}.png`,dotIcon:e=>n+`dots/${e}.png`,scavengeOption:e=>n+`scavenging/options/${e}.png`}},function(e,t,r){"use strict";r.d(t,"a",function(){return n});const n={PHASE_COMPLETION_READY:"phase_completion_ready",PHASE_COMPLETION_NOT_READY:"phase_completion_not_ready",PHASE_CHANGED:"phase_changed",QUESTION_ANSWERED:"question_answered",QUESTION_NOT_ANSWERED:"question_not_answered",OPTION_VALUE_CHANGED:"answer_value_changed",BUG_REPORT_SUCCEEDED:"bug_report_succeeded",BUG_REPORT_FAILED:"bug_report_failed",USER_REJECTED:"user_rejected"}},function(e,t,r){"use strict";r.d(t,"a",function(){return n});class n{insertBefore(e){return this._beforeInsert(),$(e).before(this.$el),this}insertAfter(e){return this._beforeInsert(),$(e).after(this.$el),this}appendTo(e){return this._beforeInsert(),$(e).append(this.$el),this}_beforeInsert(){if("function"!=typeof this.afterInsert)return;!function(e,t){let r=new MutationObserver(n=>{e:for(let i of n)for(let n of i.addedNodes)if(n===e||n.contains(e)){setTimeout(t,0),r.disconnect();break e}});r.observe(document,{attributes:!0,childList:!0,subtree:!0})}(this.$el[0],()=>this.afterInsert())}}},function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"b",function(){return a});var n=r(0);function i(e){"string"!=typeof e&&(e=String(e));var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}let s=new Set;function a(e){s.has(e)||($(`<style>${e}</style>`).appendTo("head"),s.add(e))}a(`\n            .twcheese-popup {\n                z-index: 13000;\n                display: block;\n                position: fixed;\n                top: 60px;\n                border: 19px solid #804000;\n                border-image: url(${n.a.popupBorder}) 19 19 19 19 repeat;\n                left: 50%;\n                -webkit-transform: translateX(-50%);\n                transform: translateX(-50%);\n            }\n        `);new Set(["click","mousemove","mouseover","mouseout","mousedown","mouseup"]),new Set(["mousenter","mouseleave","mouseover","mouseout"])},function(e,t,r){"use strict";r.d(t,"a",function(){return n});const n={VALUE:"value",FREE_FORM:"free_form",SELECT:"select"}},function(e,t,r){"use strict";r.d(t,"a",function(){return n});const n={ATTEMPT:"attempt",QUESTION:"question",REPORT:"report"}},function(e,t,r){"use strict";r.d(t,"a",function(){return n});class n{constructor(e){this.name=e,this.followsUpOn=null,this.autoComplete=!1}setFollowsUpOn(e){return this.followsUpOn=e,this}setAutoComplete(e){return this.autoComplete=e,this}getType(){throw Error("notimplemented")}start(){throw Error("not implemented")}checkCompletionReady(){throw Error("not implemented")}getThingsToFollowUpOn(){throw Error("not implemented")}getSummary(){throw Error("not implemented")}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ProcessFactory});var _twcheese_src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8),_twcheese_src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(10),_twcheese_src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11),_twcheese_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9);function lazyEvalUsingParent(parentPhase){return str=>()=>{let parentResult=parentPhase.result;return eval(str)}}class ProcessFactory{constructor(e){this.phaseFactory=new _twcheese_src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__.a(e)}create(e,t,r){let n=new _twcheese_src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__.a(e);for(let e of t.phases)n.enqueuePhase(this.createPhase(e));if(r){let e=new _twcheese_src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__.a(n);n.enqueuePhase(_twcheese_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__.a.create(e))}return n}createPhase(e,t){let r=this.phaseFactory.create(e,t);return this.addFollowUpPhasesForSuccess(r,e),this.addFollowUpPhasesForAnswers(r,e),r}addFollowUpPhasesForSuccess(e,t){if("PhaseAttempt"===t.type&&t.success)for(let r of t.success){let t=this.createPhase(r,lazyEvalUsingParent(e));e.addSuccessFollowUp(t)}}addFollowUpPhasesForAnswers(e,t){if("PhaseQuestion"===t.type)for(let[r,n]of Object.entries(t.questions))if("QuestionSelect"===n.type)for(let[t,i]of Object.entries(n.options))if(i.followUp)for(let n of i.followUp){let i=e.questions[r].options[t],s=this.createPhase(n,lazyEvalUsingParent(e));i.addFollowUp(s)}}}},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r(1);class i{constructor(e){this.name=e,this.phases=[],this.currentPhaseIndex=-1}enqueuePhase(e){return this.phases.push(e),this.watchPhase(e),this}insertPhase(e){return this.phases.splice(this.currentPhaseIndex+1,0,e),this.watchPhase(e),this}watchPhase(e){let t=[n.a.PHASE_COMPLETION_READY,n.a.PHASE_COMPLETION_NOT_READY,n.a.PHASE_CHANGED];$(e).on(t.join(" "),e=>$(this).trigger(e.type,e)),$(e).on(n.a.PHASE_COMPLETION_READY,()=>{e.autoComplete&&this.goToNextPhase()})}start(){this.currentPhaseIndex=-1,this.goToNextPhase()}goToNextPhase(){if(this.currentPhaseIndex>=0)for(let e of this.getCurrentPhase().getThingsToFollowUpOn())for(let t of e.followUpPhases)this.insertPhase(t);if(!this.hasNextPhase())throw Error("there's no next phase");this.currentPhaseIndex++,$(this).trigger(n.a.PHASE_CHANGED),this.getCurrentPhase().checkCompletionReady(),this.getCurrentPhase().start()}hasNextPhase(){return this.currentPhaseIndex<this.phases.length-1}getCurrentPhase(){return this.phases[this.currentPhaseIndex]}getSummarySoFar(){return this.phases.slice(0,this.currentPhaseIndex).map(e=>e.getSummary())}static create(e){return new i(e)}}},function(e,t,r){"use strict";r.d(t,"a",function(){return l});var n=r(6),i=r(1),s=r(5);const a={SUCCESS:"success",FAIL:"fail",NOT_ATTEMPTED:"not_attempted"};class l extends n.a{constructor(e){super("send bug report"),this.bugReporter=e,this.status=a.NOT_ATTEMPTED,this.error}getType(){return s.a.REPORT}start(){let e=this.bugReporter.buildReport();this.bugReporter.submitReport(e).then(e=>{this.status=a.SUCCESS,$(this).trigger({type:i.a.BUG_REPORT_SUCCEEDED,url:e.html_url})}).catch(e=>{this.error=e,this.status=a.FAIL,$(this).trigger(i.a.BUG_REPORT_FAILED)}).finally(()=>this.checkCompletionReady())}checkCompletionReady(){this.status!==a.NOT_ATTEMPTED?$(this).trigger(i.a.PHASE_COMPLETION_READY):$(this).trigger(i.a.PHASE_COMPLETION_NOT_READY)}getThingsToFollowUpOn(){return[]}getSummary(){return{phaseName:this.name}}static create(e){return new l(e)}}},function(e,t,r){"use strict";var n=r(6),i=r(1),s=r(5);const a={SUCCESS:"success",FAIL:"fail",NOT_ATTEMPTED:"not_attempted"};class l extends n.a{constructor(e,t){super(e),this.instructions,this.attempt=t,this.success=(async()=>{}),this.fail=(async()=>{}),this.status=a.NOT_ATTEMPTED,this.autoComplete=!0,this._error,this._result,this.summarizeData=(e=>e),this.ctrl={},this.successFollowUpPhases=[]}getType(){return s.a.ATTEMPT}get result(){if(this.status===a.NOT_ATTEMPTED)throw new Error("tried to get result before the attempt settled");if(this.status===a.FAIL)throw new Error("tried to get result of an attempt that failed");return this._result}async doAttempt(){try{let e=await this.abortableAttempt();this.status=a.SUCCESS,this._result=e,await this.success(e)}catch(e){console.warn(e),this.status=a.FAIL,this._error=e,await this.fail(e)}this.checkCompletionReady()}async abortableAttempt(){return new Promise(async(e,t)=>{$(this.ctrl).on(i.a.USER_REJECTED,()=>t("user rejected"));try{let r;this.followsUpOn&&(r=this.followsUpOn.result),e(await this.attempt(r,this.ctrl))}catch(e){t(e)}})}userAbort(){$(this.ctrl).trigger(i.a.USER_REJECTED)}setInstructions(e){return this.instructions=e,this}setDataSummarizer(e){return this.summarizeData=e,this}onSuccess(e){return this.success=e,this}addSuccessFollowUp(e){return this.successFollowUpPhases.push(e),e.setFollowsUpOn(this),this}get followUpPhases(){return this.status===a.SUCCESS?this.successFollowUpPhases:[]}onFail(e){return this.fail=e,this}start(){this.doAttempt()}checkCompletionReady(){this.status!==a.NOT_ATTEMPTED?$(this).trigger(i.a.PHASE_COMPLETION_READY):$(this).trigger(i.a.PHASE_COMPLETION_NOT_READY)}getThingsToFollowUpOn(){return[this]}getSummary(){return{phaseName:this.name,status:this.status,data:void 0===this._result?this._result:this.summarizeData(this._result),error:this.summarizeError()}}summarizeError(){let e=this._error;return e instanceof Error?{message:e.message,name:e.name,extra:e.extra,stack:e.stack}:e}static create(e,t){return new l(e,t)}}class o extends n.a{constructor(e){super(e),this.questions=[],this._examinedHtml}getType(){return s.a.QUESTION}lookAt(e){return this._examinedHtml=e,this}get examinedHtml(){return"function"==typeof this._examinedHtml?this._examinedHtml():this._examinedHtml}addQuestion(e){return this.questions.push(e),$(e).on(i.a.QUESTION_ANSWERED,()=>{this.checkCompletionReady()}),$(e).on(i.a.QUESTION_NOT_ANSWERED,()=>{this.checkCompletionReady()}),this}start(){}checkCompletionReady(){for(let e of this.questions)if(!e.isAnswered())return void $(this).trigger(i.a.PHASE_COMPLETION_NOT_READY);$(this).trigger(i.a.PHASE_COMPLETION_READY)}getThingsToFollowUpOn(){return this.questions.reduce((e,t)=>e.concat(t.getThingsToFollowUpOn()),[])}getSummary(){return{phaseName:this.name,questions:this.questions.map(e=>e.getSummary())}}static create(e){return new o(e)}}var d=r(4);class c{constructor(e){this.text=e,this.options=[],this.selectedOptionIndex=null}getType(){throw Error("not implemented")}addOption(e){return this.options.push(e),this}setSelectedOption(e){return this.selectedOptionIndex=e,$(this).trigger(i.a.QUESTION_ANSWERED),this}isAnswered(){return null!==this.selectedOptionIndex}getSelectedOption(){return this.options[this.selectedOptionIndex]}getThingsToFollowUpOn(){let e=this.getSelectedOption();return e.followUpPhases.length>0?[e]:[]}getSummary(){return{question:this.text,answer:this.getSelectedOption().value}}static create(e){return new c(e)}}class u extends c{getType(){return d.a.SELECT}static create(e){return new u(e)}}class h{constructor(e,t,r=""){this.text=e,this.value=t,this.className=r,this.followUpPhases=[]}addFollowUp(e){return this.followUpPhases.push(e),e.setFollowsUpOn(this),this}setValue(e){this.value=e,$(this).trigger(i.a.OPTION_VALUE_CHANGED)}static create(e,t,r){return new h(e,t,r)}}class p extends c{constructor(e,t,r=0){super(e),this.minResponseLength=r,this.options=[h.create(t,"","free-form")],this.setSelectedOption(0),this.watchSelectedOption()}getType(){return d.a.FREE_FORM}watchSelectedOption(){$(this.getSelectedOption()).on(i.a.OPTION_VALUE_CHANGED,()=>{this.isAnswered()?$(this).trigger(i.a.QUESTION_ANSWERED):$(this).trigger(i.a.QUESTION_NOT_ANSWERED)})}isAnswered(){return super.isAnswered()&&this.options[0].value.length>=this.minResponseLength}static create(e,t,r){return new p(e,t,r)}}const g={CORRECT:"correct",INCORRECT:"incorrect",NOT_SURE:"not_sure"},m=1;class b extends c{constructor(e,t){super(e),this._valueQuestioned=t,this.options=[h.create("Correct",g.CORRECT,"correct"),h.create("Incorrect",g.INCORRECT,"incorrect"),h.create("Not sure",g.NOT_SURE,"not-sure")]}get value(){return"function"==typeof this._valueQuestioned?this._valueQuestioned():this._valueQuestioned}getType(){return d.a.VALUE}addFollowUp(e){return this.options[m].addFollowUp(e),this}getSummary(){return Object.assign(super.getSummary(),{valueChecked:this.value})}static create(e,t){return new b(e,t)}}class f{create(e,t){switch(e.type){case"QuestionFreeForm":return this.createQuestionFreeForm(e);case"QuestionSelect":return this.createQuestionSelect(e);case"QuestionValue":return this.createQuestionValue(e,t);default:throw`unrecognized question type: ${e.type}`}}createQuestionFreeForm(e){let t=e.minResponseLength||0;return p.create(e.ask,e.placeholderText,t)}createQuestionSelect(e){let t=u.create(e.ask);for(let r of e.options)t.addOption(h.create(r.answer,r.value));return t}createQuestionValue(e,t){let r=t(e.examine);return b.create(e.ask,r)}}r.d(t,"a",function(){return w});class w{constructor(e){this.actions=e,this.questionFactory=new f}create(e,t){switch(e.type){case"PhaseAttempt":return this.createPhaseAttempt(e);case"PhaseQuestion":return this.createPhaseQuestion(e,t);case"PhaseReport":return this.createPhaseReport(e);default:throw Error(`unrecognized phase type ${e.type}`)}}createPhaseAttempt(e){let t=this.actions[e.action];if(void 0===t)throw Error(`unrecognized action: ${e.action}`);let r=l.create(e.internalName,t.execute);return t.summarizeResult&&r.setDataSummarizer(t.summarizeResult),e.instructions&&r.setInstructions(e.instructions),r}createPhaseQuestion(e,t){let r=o.create(e.internalName);e.lookAt&&r.lookAt(t(e.lookAt));for(let n of e.questions){let e=this.questionFactory.create(n,t);r.addQuestion(e)}return r}}},function(e,t,r){"use strict";class n{constructor(e){this.process=e,this.censoredProps=new Set(["csrf","birthdate"])}getCollectibleData(){return this.scrub(this.buildData())}buildData(){let e=window.navigator;return{process:this.process.getSummarySoFar(),contentHtml:document.getElementById("contentContainer").outerHTML,navigator:{appCodeName:e.app,appName:e.appName,appVersion:e.appVersion,platfrom:e.platfrom,userAgent:e.userAgent,languages:$.extend(!0,[],e.languages),oscpu:e.oscpu},gameData:$.extend(!0,{},window.game_data)}}scrub(e){if("object"==typeof e&&null!==e)for(let t of Object.keys(e))this.censoredProps.has(t)?e[t]="CENSORED":e[t]=this.scrub(e[t]);return"string"==typeof e?this.censorCsrfInString(e):e}censorCsrfInString(e){return e.replace(/((&|&amp;)h=)(\w+)/g,"$1CENSORED").replace(/(\?h=)(\w+)(&|&amp;)/g,"$1CENSORED$3").replace(/(csrf_token = ')(\w+)/g,"$1CENSORED").replace(/("csrf":")(\w+)/g,"$1CENSORED")}}let i={bugReport:{url:"https://56hqsw3c2c.execute-api.us-east-2.amazonaws.com/prod/bugreport"}};r.d(t,"a",function(){return s});class s{constructor(e){this.process=e}buildReport(){return{title:"[Bug report] "+this.process.name,dataCollected:new n(this.process).getCollectibleData()}}async submitReport(e){let t=["|game version|world|player|twcheese|","|---|---|---|---|",`|${game_data.majorVersion}|${game_data.world}|${game_data.player.name}|${window.TwCheese.version}|`,"```"+JSON.stringify(e.dataCollected,null,2)+"```"].join("\n");return await this.createIssue(e.title,t)}async createIssue(e,t){let r=await fetch(i.bugReport.url,{method:"POST",body:JSON.stringify({title:e,message:t})});if(!r.ok)throw new Error(`Failed to create issue. [${r.status}: ${r.statusText}]`);return await r.json()}}},function(e,t,r){r(13),e.exports=r(14)},function(e,t,r){"use strict";function n(e,t,r){let n=t.split(".");for(let t=0;t<n.length-1;t++){let i=n[t];if("object"!=typeof e[i]||null===i)return r;e=e[i]}let i=e[n[n.length-1]];return void 0===i?r:i}r.r(t);var i={buildings:{},report:{},twcheese:{}};switch(game_data.market){default:i.buildings.main="Headquarters",i.buildings.barracks="Barracks",i.buildings.stable="Stable",i.buildings.garage="Workshop",i.buildings.church="Church",i.buildings.church_f="First church",i.buildings.snob="Academy",i.buildings.smith="Smithy",i.buildings.place="Rally point",i.buildings.statue="Statue",i.buildings.market="Market",i.buildings.wood="Timber camp",i.buildings.stone="Clay pit",i.buildings.iron="Iron mine",i.buildings.farm="Farm",i.buildings.storage="Warehouse",i.buildings.hide="Hiding place",i.buildings.wall="Wall",i.buildings.watchtower="Watchtower",i.report.catDamage="Damage by catapults:",i.report.ramDamage="Damage by rams:",i.report.haul="Haul:",i.report.loyalty="Loyalty:",i.report.unitsInTransit="Defender's troops, that were in transit",i.report.deletedPlayer="(deleted)",i.report.unread="(new)";break;case"cz":i.buildings.main="Hlavní budova",i.buildings.barracks="Kasárna",i.buildings.stable="Stáj",i.buildings.garage="Dílna",i.buildings.church="Kostel",i.buildings.church_f="První kostel",i.buildings.snob="Panský dvůr",i.buildings.smith="Kovárna",i.buildings.place="Nádvoří",i.buildings.statue="Socha",i.buildings.market="Tržiště",i.buildings.wood="Dřevorubec",i.buildings.stone="Lom na těžbu hlíny",i.buildings.iron="Železný důl",i.buildings.farm="Selský dvůr",i.buildings.storage="Skladiště",i.buildings.hide="Skrýš",i.buildings.wall="Hradby",i.buildings.watchtower="Watchtower",i.report.catDamage="Škoda vzniklá střelbou z katapultu:",i.report.ramDamage="Škoda vzniklá beranidlem:",i.report.haul="Kořist:",i.report.loyalty="Oddanost:",i.report.unitsInTransit="Vojsko obránce, které bylo na cestě",i.report.deletedPlayer="(deleted)",i.report.unread="(new)";break;case"se":i.buildings.main="Högkvarter",i.buildings.barracks="Barack",i.buildings.stable="Stall",i.buildings.garage="Verkstad",i.buildings.church="Kyrka",i.buildings.church_f="Första Kyrkan",i.buildings.snob="Akademi",i.buildings.smith="Smedja",i.buildings.place="Samlingsplats",i.buildings.statue="Staty",i.buildings.market="Marknad",i.buildings.wood="Sågverk",i.buildings.stone="Lergrop",i.buildings.iron="Järngruva",i.buildings.farm="Farm",i.buildings.storage="Förråd",i.buildings.hide="Gömställe",i.buildings.wall="Mur",i.buildings.watchtower="Watchtower",i.report.catDamage="Skada gjord av katapulter:",i.report.ramDamage="Skada gjorda av Murbräckan:",i.report.haul="Byte:",i.report.loyalty="Lojalitet:",i.report.unitsInTransit="Enheter utanför byn",i.report.deletedPlayer="(borttaget)",i.report.unread="(new)";break;case"gr":i.buildings.main="Επιτελείο",i.buildings.barracks="Στρατώνας",i.buildings.stable="Στάβλος",i.buildings.garage="Εργαστήριο",i.buildings.church="Εκκλησία",i.buildings.church_f="ΠρώτηΕκκλησία",i.buildings.snob="Ακαδημία",i.buildings.smith="Οπλοποιείο",i.buildings.place="ΜέροςΣυγκέντρωσης",i.buildings.statue="Άγαλμα",i.buildings.market="Αγορά",i.buildings.wood="Ξυλουργείο",i.buildings.stone="Λατομείο",i.buildings.iron="Σιδηρωρυχείο",i.buildings.farm="Αγρόκτημα",i.buildings.storage="Αποθήκη",i.buildings.hide="Κρυψώνα",i.buildings.wall="Τείχος",i.buildings.watchtower="Watchtower",i.report.catDamage="Ζημία που έκαναν οι καταπέλτες:",i.report.ramDamage="Ζημιά που προκλήθηκε από τον πολιορκητικό κριό:",i.report.haul="Αλλαγή:",i.report.loyalty="Πίστη:",i.report.unitsInTransit="Στρατεύματα αμυνόμενου που ήταν σε μεταφορά",i.report.deletedPlayer="(διεγραμμένο)",i.report.unread="(νέο)";break;case"hr":i.buildings.main="Sjedište",i.buildings.barracks="Vojarna",i.buildings.stable="Štala",i.buildings.garage="Radionica",i.buildings.church="Crkva",i.buildings.church_f="Prva crkva",i.buildings.snob="Akademija",i.buildings.smith="Kovačnica",i.buildings.place="Okupljalište",i.buildings.statue="Spomenik",i.buildings.market="Tržnica",i.buildings.wood="Drvosječa",i.buildings.stone="Glinokop",i.buildings.iron="Rudnik željeza",i.buildings.farm="Farma",i.buildings.storage="Spremište",i.buildings.hide="Skrovište",i.buildings.wall="Zid",i.buildings.watchtower="Watchtower",i.report.catDamage="Šteta nanešena katapultima:\t",i.report.ramDamage="Šteta nanešena ovnovima:",i.report.haul="Nosivost:",i.report.loyalty="Odanost:",i.report.unitsInTransit="Obrambene postrojbe koje su bile na putu",i.report.deletedPlayer="(obrisano)";break;case"no":i.buildings.main="Hovedkvarter",i.buildings.barracks="Brakker",i.buildings.stable="Stall",i.buildings.garage="Verksted",i.buildings.church="Kirke",i.buildings.church_f="Første Kirke",i.buildings.snob="Akademi",i.buildings.smith="Smie",i.buildings.place="Samlingsplass",i.buildings.statue="Statue",i.buildings.market="Marked",i.buildings.wood="Hogstfelt",i.buildings.stone="Leirgrav",i.buildings.iron="Jerngruve",i.buildings.farm="Gård",i.buildings.storage="Varehus",i.buildings.hide="Skjulested",i.buildings.wall="Mur",i.buildings.watchtower="Watchtower",i.report.catDamage="Skade forårsaket av katapulter:",i.report.ramDamage="Skade forårsaket av rambukker:",i.report.haul="Bytte",i.report.loyalty="Lojalitet:",i.report.unitsInTransit="Forsvarer",i.report.unitsInTransit="Antall",i.report.deletedPlayer="(slettet)",i.report.unread="(ny)";break;case"pt":i.buildings.main="Edifício Principal",i.buildings.barracks="Quartel",i.buildings.stable="Estábulo",i.buildings.garage="Oficina",i.buildings.church="Igreja",i.buildings.church_f="Primeira Igreja",i.buildings.snob="Academia",i.buildings.smith="Ferreiro",i.buildings.place="Praça de Reuniões",i.buildings.statue="Estátua",i.buildings.market="Mercado",i.buildings.wood="Bosque",i.buildings.stone="Poço de Argila",i.buildings.iron="Mina de Ferro",i.buildings.farm="Fazenda",i.buildings.storage="Armazém",i.buildings.hide="Esconderijo",i.buildings.wall="Muralha",i.buildings.watchtower="Watchtower",i.report.catDamage="Dano provocado por catapultas:",i.report.ramDamage="Dano provocado por aríetes:",i.report.haul="Busca minuciosa:",i.report.loyalty="Lealdade:",i.report.unitsInTransit="Unidades fora da aldeia",i.report.deletedPlayer="(eliminado)",i.report.unread="(novo)";break;case"br":i.buildings.main="Edifício principal",i.buildings.barracks="Quartel",i.buildings.stable="Estábulo",i.buildings.garage="Oficina",i.buildings.church="Igreja",i.buildings.church_f="Primeira igreja",i.buildings.snob="Academia",i.buildings.smith="Ferreiro",i.buildings.place="Praça de reunião",i.buildings.statue="Estátua",i.buildings.market="Mercado",i.buildings.wood="Bosque",i.buildings.stone="Poço de argila",i.buildings.iron="Mina de ferro",i.buildings.farm="Fazenda",i.buildings.storage="Armazém",i.buildings.hide="Esconderijo",i.buildings.wall="Muralha",i.buildings.watchtower="Torre de vigia",i.report.catDamage="Dano - catapultas:",i.report.ramDamage="Dano - aríetes:",i.report.haul="Saque:",i.report.loyalty="Lealdade:",i.report.unitsInTransit="Tropas defensivas em trânsito",i.report.deletedPlayer="(apagado)",i.report.unread="(novo)"}let s=new class{constructor(e){this.gameTexts=e}t(e){return n(this.gameTexts,e)}includes(e,t){let r=this.t(t);return"string"==typeof e?e.includes(r):$(e).html().includes(r)}first(e,t){let r=this.t(t);return $(e).filter(`:contains('${n=r,n.replace(/'/g,"\\'")}')`)[0];var n}buildingType(e){let t=$(e).text();for(let[e,r]of Object.entries(this.gameTexts.buildings))if(t.includes(r))return e}}(i);var a=r(0);class l{constructor(){this.subject=null,this.attackIcons=null,this.attackerName=null,this.attackerNobleDied=!1,this.attackerVillage=null,this.buildingLevels=null,this.defenderName=null,this.defenderVillage=null,this.defenderSurvivors=null,this.dotColor=null,this.haulStatus=l.HAUL_STATUS_UNKNOWN,this.isForwarded=!1,this.loyalty=null,this.note=null,this.reportId=null,this.resources=null,this.strTimeReceived=null,this.timeLaunched=null,this.wasAttackFeint=!1}wasDefenderCleared(){return this.defenderSurvivors&&this.defenderSurvivors.isZero()}haulStatusIconSrc(){if(this.haulStatus===l.HAUL_STATUS_UNKNOWN)throw Error("There's no icon.... that's why the status is unknown!");return this.haulStatus===l.HAUL_STATUS_FULL?a.a.haulFull:a.a.haulPartial}defenderDistance(e){return this.defenderVillage?Math.round(100*this.defenderVillage.distanceTo(e))/100:"?"}}l.HAUL_STATUS_UNKNOWN=-1,l.HAUL_STATUS_PARTIAL=0,l.HAUL_STATUS_FULL=1;class o{constructor(e,t,r){this.id=parseInt(e),this.x=parseInt(t),this.y=parseInt(r)}distanceTo(e){let t=this.x-e.x,r=this.y-e.y;return Math.hypot(t,r)}}class d{constructor(e,t){this.type=e,this.amount=t}valueOf(){return this.amount}toString(){return this.amount}toDebugString(){return this.amount}imageSrc(){return a.a[this.type]}}d.TYPE_TIMBER="wood",d.TYPE_CLAY="stone",d.TYPE_IRON="iron";class c{constructor(e=0,t=0,r=0){this.wood=new d(d.TYPE_TIMBER,e),this.stone=new d(d.TYPE_CLAY,t),this.iron=new d(d.TYPE_IRON,r)}sum(){return this.wood+this.stone+this.iron}add(e){return new c(this.wood+e.wood,this.stone+e.stone,this.iron+e.iron)}multiply(e){return new c(this.wood*e,this.stone*e,this.iron*e)}cap(e){return new c(Math.min(this.wood,e),Math.min(this.stone,e),Math.min(this.iron,e))}equals(e){return this.wood.valueOf()===e.wood.valueOf()&&this.stone.valueOf()===e.stone.valueOf()&&this.iron.valueOf()===e.iron.valueOf()}toArray(){return[this.wood.amount,this.stone.amount,this.iron.amount]}}c.TYPES=[d.TYPE_TIMBER,d.TYPE_CLAY,d.TYPE_IRON];class u{constructor(e){this.id=e,this.props={},this._loadCachedData()}get(e,t){return n(this.props,e,t)}set(e,t){!function(e,t,r){let n=t.split(".");for(let t=0;t<n.length-1;t++){let r=n[t];"object"==typeof e[r]&&null!==r||(e[r]={}),e=e[r]}e[n[n.length-1]]=r}(this.props,e,t),this._save()}initProps(e){this.props=e}_loadCachedData(){let e=window.localStorage.getItem(this.id);if(e){let t=JSON.parse(e);return this.props=t.props||t,t}return null}_save(){this._beforeSave(),window.localStorage.setItem(this.id,JSON.stringify(this._getCacheableData()))}_beforeSave(){}_getCacheableData(){return{props:this.props}}}let h=new class{constructor(e){this.maxBurstsPerSecond=e,this.recentRequests=new Array(e)}requestWasMade(){this.recentRequests.unshift(performance.now()),this.recentRequests.pop()}async sleepIfNeeded(){let e=this.recentRequests[this.maxBurstsPerSecond-1];if(void 0===e)return;let t=e+1e3-performance.now();return t<=0?void 0:new Promise(function(e,r){setTimeout(e,t)})}}(5),p=window.fetch;async function g(e){await h.sleepIfNeeded();let t=await fetch(e),r=await t.text(),n=(new DOMParser).parseFromString(r,"text/html");return Object.defineProperty(n,"URL",{get:()=>e}),n}function m(e,t,r="GET"){return"https://"+document.domain+window.TribalWars.buildURL(r,e,t)}function b(e,t,r=window.game_data.village.id){let n={from:"simulator",village:r,target_village_id:t};for(let[t,r]of Object.entries(e))n["att_"+t]=r;return m("place",n)}window.fetch=function(){return h.requestWasMade(),p.apply(this,arguments)};class f extends u{setUrl(e){return this.url=e,this}setTtl(e){return this.ttl=1e3*e,this}async ensureUpdated(){this.needsUpdate()&&await this.update()}needsUpdate(){let e=(new Date).getTime(),t=this.ttl||86400;return!this.timeUpdated||t<e-this.timeUpdated}async update(){let e=await async function(e){await h.sleepIfNeeded();let t=await fetch(e),r=await t.text(),n=(new DOMParser).parseFromString(r,"text/xml");return Object.defineProperty(n,"URL",{get:()=>e}),n}(this.url);this._processXml(e),this._save()}_processXml(e){this.props=function e(t){if(0===t.children.length)return parseFloat(t.innerHTML)||null;let r={};for(let n of t.children)r[n.tagName]=e(n);return r}(e).config}_loadCachedData(){let e=super._loadCachedData();e&&(this.timeUpdated=e.timeUpdated)}_beforeSave(){this.timeUpdated=(new Date).getTime()}_getCacheableData(){return Object.assign({},super._getCacheableData(),{timeUpdated:this.timeUpdated})}}let w=new u("twcheese.userConfig"),y=new f("twcheese.gameConfig").setUrl(`https://${document.domain}/interface.php?func=get_config`).setTtl(28800),_=new f("twcheese.buildingConfig").setUrl(`https://${document.domain}/interface.php?func=get_building_info`).setTtl(28800),v=new f("twcheese.troopConfig").setUrl(`https://${document.domain}/interface.php?func=get_unit_info`).setTtl(28800);let T={main:{maxLevel:30,minLevel:1,pop:5,popFactor:1.17,req:{}},barracks:{maxLevel:25,minLevel:0,pop:7,popFactor:1.17,req:{main:3}},stable:{maxLevel:20,minLevel:0,pop:8,popFactor:1.17,req:{main:10,barracks:5,smith:5}},garage:{maxLevel:15,minLevel:0,pop:8,popFactor:1.17,req:{main:10,smith:10}},church:{maxLevel:3,minLevel:0,pop:5e3,popFactor:1.55,req:{main:5,farm:5}},church_f:{maxLevel:1,minLevel:0,pop:5,popFactor:1.55,req:{}},snob:{maxLevel:3,minLevel:0,pop:80,popFactor:1.17,req:{main:20,smith:20,market:10}},smith:{maxLevel:20,minLevel:0,pop:20,popFactor:1.17,req:{main:5,barracks:1}},place:{maxLevel:1,minLevel:0,pop:0,popFactor:1.17,req:{}},statue:{maxLevel:1,minLevel:0,pop:10,popFactor:1.17,req:{}},market:{maxLevel:25,minLevel:0,pop:20,popFactor:1.17,req:{main:3,storage:2}},wood:{maxLevel:30,minLevel:0,pop:5,popFactor:1.155,req:{}},stone:{maxLevel:30,minLevel:0,pop:10,popFactor:1.14,req:{}},iron:{maxLevel:30,minLevel:0,pop:10,popFactor:1.17,req:{}},farm:{maxLevel:30,minLevel:1,pop:0,popFactor:1,req:{}},storage:{maxLevel:30,minLevel:1,pop:0,popFactor:1.15,req:{}},hide:{maxLevel:10,minLevel:0,pop:2,popFactor:1.17,req:{}},wall:{maxLevel:20,minLevel:0,pop:5,popFactor:1.17,req:{barracks:1}},watchtower:{maxLevel:20,minLevel:0,pop:500,popFactor:1.18,req:{main:5,farm:5}}},k=["main","barracks","stable","garage","church","church_f","snob","smith","place","statue","market","wood","stone","iron","farm","storage","hide","wall","watchtower"];function S(e){return 0===e?5*y.get("speed"):30*y.get("speed")*1.163118**(e-1)}function x(e,t){let r=_.get(e);return void 0===r?0:Math.round(r.pop*r.pop_factor**(t-1))}class C{constructor(e=0){for(let t of k)this[t]=e}populationUsed(){let e=0;for(let t of k){e+=x(t,this[t])}return e}populationCap(){return Math.round(240*1.172103**(this.farm-1))}resourceCap(){return Math.round(1e3*1.2294934**(this.storage-1))}resourceProductionHourly(){return new c(S(this.wood),S(this.stone),S(this.iron))}hideableResources(){return 0===this.hide?0:Math.round(112.4859*1.3335**this.hide)}canUpgrade(e){return!(this[e]>=function(e){let t=_.get(e);return void 0===t?0:t.max_level}(e))&&this.areRequirementsMet(e)}areRequirementsMet(e){let t=function(e){let t=T[e];return void 0===t?[]:t.req}(e);for(let[e,r]of Object.entries(t))if(r>this[e])return!1;return!0}toArray(){return k.map(e=>this[e])}static fromArray(e){let t=new C;return e.forEach((e,r)=>{t[k[r]]=e}),t}static typeAt(e){return k[e]}}let E={buildingTypesOnWorld(){return k.filter(e=>this.typeExistsOnWorld(e))},typeExistsOnWorld:e=>void 0!==_.get(e)},I=["spear","sword","axe","archer","spy","light","marcher","heavy","ram","catapult","knight","snob","militia"];function R(e){let t=v.get(e);return void 0===t?0:t.speed}function L(e){let t=v.get(e);return void 0===t?0:t.carry}class O{constructor(){for(let e of I)this[e]=0}clone(){return Object.assign(new O,this)}filter(e){let t=new O;for(let r of I)e.includes(r)&&(t[r]=this[r]);return t}isZero(){for(let e of Object.values(this))if(0!==e)return!1;return!0}sum(){let e=0;for(let t of Object.values(this))e+=t;return e}each(e){for(let t of I){e(t,this[t])}}carryCapacity(){let e=0;for(let t of I)e+=this[t]*L(t);return e}populationUsed(){return I.reduce((e,t)=>e+function(e){let t=v.get(e);return void 0===t?0:t.pop}(t)*this[t],0)}travelDuration(e,t="attack"){return P(this.travelMinutesPerField(t),e)}travelMinutesPerField(e="attack"){if("support"===e&&this.knight>0)return R("knight");let t=I.filter(e=>this[e]>0).map(e=>R(e));return Math.max(...t)}subtract(e){let t=new O;for(let[r,n]of Object.entries(this))t[r]=n-e[r];return t}zeroNegatives(){let e=new O;for(let[t,r]of Object.entries(this))e[t]=Math.max(0,r);return e}toArray(){return I.map(e=>this[e])}static fromArray(e){let t=new O;return e.forEach((e,r)=>{t[I[r]]=e}),t}}function P(e,t){return 1e3*Math.round(t*e*60)}let D={troopTypesOnWorld:()=>window.game_data.units,existsOnWorld:e=>void 0!==v.get(e),countToCarry(e,t,r=0){let n=t/(L(e)*(100+r)/100);return Math.round(10*n)/10},carryCapacity:(e,t=1)=>L(e)*t,travelDuration:(e,t)=>P(R(e),t)},N=1e3*window.server_utc_diff,A=6e4*(new Date).getTimezoneOffset(),M=function(e){return e.addMilliseconds(N)};class U extends Date{constructor(){0===arguments.length?super(window.Timing.getCurrentServerTime()):super(...arguments)}clone(){return new U(this.getTime())}addDays(e){let t=this.clone();return t.setUTCDate(this.getUTCDate()+e),t}addHours(e){let t=this.clone();return t.setUTCHours(this.getUTCHours()+e),t}addMinutes(e){let t=this.clone();return t.setUTCMinutes(this.getUTCMinutes()+e),t}addSeconds(e){let t=this.clone();return t.setUTCSeconds(this.getUTCSeconds()+e),t}addMilliseconds(e){let t=this.clone();return t.setUTCMilliseconds(this.getUTCMilliseconds()+e),t}subDays(e){return this.addDays(-e)}subHours(e){return this.addHours(-e)}subMinutes(e){return this.addMinutes(-e)}subSeconds(e){return this.addSeconds(-e)}subMilliseconds(e){return this.addMilliseconds(-e)}getServerYear(){return M(this).getUTCFullYear()}getServerMonth(){return M(this).getUTCMonth()}getServerDate(){return M(this).getUTCDate()}getServerHours(){return M(this).getUTCHours()}getServerHours(){return M(this).getUTCHours()}getServerMinutes(){return M(this).getUTCMinutes()}getServerSeconds(){return M(this).getUTCSeconds()}getServerMilliseconds(){return M(this).getUTCMilliseconds()}isTodayOnServer(){let e=M(this),t=M(new U);return e.isSameDayInUtc(t)}isTomorrowOnServer(){let e=M(this),t=M(new U).addDays(1);return e.isSameDayInUtc(t)}isSameDayInUtc(e){return this.getUTCFullYear()===e.getUTCFullYear()&&this.getUTCMonth()===e.getUTCMonth()&&this.getUTCDate()===e.getUTCDate()}startOfHour(){let e=this.clone();return e.setUTCMinutes(0),e.setUTCSeconds(0),e.setUTCMilliseconds(0),e}endOfHour(){let e=this.clone();return e.setUTCMinutes(59),e.setUTCSeconds(59),e.setUTCMilliseconds(999),e}startOfSecond(){let e=this.clone();return e.setUTCMilliseconds(0),e}equals(e){return this.getTime()===e.getTime()}toHtml(e=!0){let t=M(this),r=t.getUTCFullYear(),n=t.toLocaleString("default",{month:"short"}),i=t.getUTCDate().toString().padStart(2,"0"),s=t.getUTCHours().toString().padStart(2,"0"),a=t.getUTCMinutes().toString().padStart(2,"0"),l=t.getUTCSeconds().toString().padStart(2,"0"),o=t.getUTCMilliseconds().toString().padStart(3,"0"),d=`${n} ${i}, ${r} ${s}:${a}:${l}`;return e&&(d+=`<span class="small grey">:${o}</span>`),d}toDebugString(){let e=M(this);return`${e.getUTCFullYear()}-${e.getUTCMonth().toString().padStart(2,"0")}-${e.getUTCDate().toString().padStart(2,"0")} ${e.getUTCHours().toString().padStart(2,"0")}:${e.getUTCMinutes().toString().padStart(2,"0")}:${e.getUTCSeconds().toString().padStart(2,"0")}.${e.getUTCMilliseconds().toString().padStart(3,"0")} ServerTime(UTC+${Math.round(N/36e4)/10})`}imageSrc(){return a.a.calendar}static newServerDate(){let e=new U(...arguments);return arguments.length>1&&(e=e.addMilliseconds(0-N-A)),e}static monthNumber(e){return new Date(e+" 1 1970").getMonth()}}class H{async rename(e,t){let r=this.createName(e,t);return await async function(e,t,r){return await h.sleepIfNeeded(),new Promise(function(n,i){window.TribalWars.post(e,t,r,n,i)})}("report",{ajaxaction:"edit_subject",report_id:e.reportId},{text:r}),$(this).trigger({type:"report-renamed",reportId:e.reportId,newName:r}),r}createName(e,t=""){var r="twCheese: ";r+=e.attacker.name.replace(s.t("report.deletedPlayer"),"")+" ",r+="("+e.attackerVillage.x+"|"+e.attackerVillage.y+","+e.attackerVillage.id+")",r+=e.defender.name.replace(s.t("report.deletedPlayer"),""),r+="("+e.defenderVillage.x+"|"+e.defenderVillage.y+","+e.defenderVillage.id+")";let n=e.calcTimingInfo();return r+="_t:"+Math.floor(n.launchTime.getTime()/1e3)+". ",e.attackerLosses.snob>0&&(r+="_x"),e.loyalty&&(r+="_l:"+e.loyalty.after+"."),e.defenderSurvivors&&(r+="_d["+e.defenderSurvivors.toArray()+"] "),e.buildingLevels&&(r+="_b["+e.buildingLevels.toArray()+"] "),e.resources&&(r+="_r["+e.resources.toArray()+"] "),e.wasAttackFeint()&&(r+="_f"),t&&(r+="_n:"+t),r}parseName(e){if((e=e.trim()).startsWith("twCheese:"))try{return this.parseTwCheeseName(e)}catch(t){console.error("parseTwCheeseName failed:",e,t)}else try{return this.parseDefaultName(e)}catch(t){console.info("parseDefaultName failed:",e)}let t=new l;return t.subject=e,t}parseDefaultName(e){let t=new l;t.subject=e;let[,r,n,i]=e.match(/(.*?) \(.+\((\d+)\|(\d+)/);return t.attackerName=r,t.defenderVillage=new o(0,n,i),t}parseTwCheeseName(e){let t=new l;t.subject=e;let[,r,n,i,s,a,d,u,h]=e.match(/twCheese: (.*?) \((\d+)\|(\d+),(\d+)\)(.*?)\((\d+)\|(\d+),(\d+)\)/);t.attackerName=r,t.attackerVillage=new o(s,n,i),t.defenderName=a,t.defenderVillage=new o(h,d,u),e.includes("_n:")&&(t.note=e.match(/_n:(.+)/)[1],e=e.replace(/_n:.+/,""));let p=e.match(/_b(\[\S+\])/);if(p&&(t.buildingLevels=C.fromArray(JSON.parse(p[1]))),p=e.match(/_r(\[\S+\])/)){let e=JSON.parse(p[1]);t.resources=new c(e[0],e[1],e[2])}return(p=e.match(/_d(\[\S+\])/))&&(t.defenderSurvivors=O.fromArray(JSON.parse(p[1]))),(p=e.match(/_l:(\d+)/))&&(t.loyalty={after:parseInt(p[1])}),(p=e.match(/_t:(\d+)/))&&(t.timeLaunched=U.newServerDate(1e3*parseInt(p[1]))),t.attackerNobleDied=e.includes("_x"),t.wasAttackFeint=e.includes("_f"),t}availableChars(e){return 255-e.length}}let F=[0,2,6,10,15,21,28,36,45,56,68,82,98,115,136,159,185,215,248,286,328,376,430,490,558,634,720,815,922,1041,1175,1175],B=[0,400,500,600,600],j=[0,2,4,7,10,14,19,24,30,37,45,55,65,77,91,106,124,143,166,191,219],V=["church_f","hide"];class q{suggestSiegeUnits(e){let t={},r={};function n(n){if(V.includes(n))return t[n]="NA",void(r[n]="NA");let i=e[n];if("?"===i)return t[n]="?",void(r[n]="?");let s=function(e){switch(e){case"wall":return j;case"church":return B;default:return F}}(n);t[n]=s[i];let a=e.canUpgrade(n)?i+1:i;r[n]=s[a]}for(let t in e)n(t);return{oneShotScouted:t,oneShotUpgraded:r}}}class z{constructor(){this.attacker=null,this.attackerLosses=null,this.attackerQuantity=null,this.attackerSurvivors=null,this.attackerVillage=null,this.battleTime=null,this.buildingLevels=null,this.catDamage=null,this.defender=null,this.defenderLosses=null,this.defenderQuantity=null,this.defenderSurvivors=null,this.defenderVillage=null,this.dotColor=null,this.espionageLevel=null,this.haul=null,this.loyalty=null,this.luck=null,this.morale=null,this.ramDamage=null,this.reportId=null,this.resources=null,this.unitsInTransit=null,this.unitsOutside=null}calcTimingInfo(){let e=this.attackerVillage.distanceTo(this.defenderVillage),t=this.attackerQuantity.travelDuration(e,"attack");return{launchTime:this.battleTime.subMilliseconds(t),returnTime:this.battleTime.addMilliseconds(t).startOfSecond()}}calcPopulation(){if(this.espionageLevel<2)throw Error("not enough information to determine population");let e=this.buildingLevels.populationUsed(),t=this.defenderQuantity.populationUsed();return this.unitsOutside&&(t+=this.unitsOutside.populationUsed()),{buildings:e,troops:t,idle:this.buildingLevels.populationCap()-e-t}}calcRaidScouted(e=0){if(this.espionageLevel<1)throw Error("not enough information");return this.calcRaidUnits(this.resources.sum(),e)}calcRaidPredicted(e,t,r=0){if(this.espionageLevel<2)throw Error("not enough information");let n=this.defenderVillage.distanceTo(e),i=this.buildingLevels.resourceCap()-this.buildingLevels.hideableResources(),s=this.buildingLevels.resourceProductionHourly(),a=(t-this.battleTime)/36e5,l=s.multiply(a),o=this.resources.add(l),d=new O;for(let e of I){let t=D.travelDuration(e,n)/36e5,a=s.multiply(t),l=o.add(a).cap(i);d[e]=D.countToCarry(e,l.sum(),r)}return d}calcRaidPeriodic(e,t=0){let r=this.buildingLevels.resourceProductionHourly().multiply(e),n=this.buildingLevels.resourceCap()-this.buildingLevels.hideableResources(),i=r.cap(n).sum();return this.calcRaidUnits(i,t)}calcRaidUnits(e,t=0){let r=new O;for(let n of I)r[n]=D.countToCarry(n,e,t);return r}wasAttackFeint(){let e=this.attackerQuantity;return 0===e.snob&&e.populationUsed()<=130}wasDefenderCleared(){return this.defenderSurvivors&&this.defenderSurvivors.isZero()}suggestSiegeUnits(){if(this.espionageLevel<2)throw Error("not enough information");return(new q).suggestSiegeUnits(this.buildingLevels)}}class W{constructor(e,t){this.id=e,this.name=t}}class Q{constructor(e,t){this.troopCounts=e,this.village=t}}function Y(e,t){switch(t){case"br":return function(e){let[,t,r,n,i,s,a,l]=e.match(/(\S+) (\d+), (\d+)  (\d+):(\d+):(\d+):?(\d+)?/),o=["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"].indexOf(t.toLowerCase());return U.newServerDate(n,o,r,i,s,a,l||0)}(e);case"cz":return function(e){let[t,r,n,i,s,a,l]=e.match(/\d+/g),o="20"+n,d=r-1;return U.newServerDate(o,d,t,i,s,a,l||0)}(e);case"pt":return function(e){let[,t,r,n,i,s,a,l]=e.match(/(\d+)\/(\D+)\/(\d+) \((\d+):(\d+):(\d+)\):?(\d+)?/),o=U.monthNumber(r);return U.newServerDate(n,o,t,i,s,a,l||0)}(e)}return function(e){let[,t,r,n,i,s,a,l]=e.match(/(\S+) (\d+), (\d+)  (\d+):(\d+):(\d+):?(\d+)?/),o=U.monthNumber(t);return U.newServerDate(n,o,r,i,s,a,l||0)}(e)}function G(e){let t=$(e).clone();t.find(".grey").remove();let r=function(e){let r=t.find("span."+e).get(0);return r?parseInt($(r).parent().text()):0};return new c(r("wood"),r("stone"),r("iron"))}function K(e){if(s.includes(e,"report.deletedPlayer"))return new W(-1,$(e).text());if("---"===e.innerHTML)return new W(0,"---");let t=e.firstChild,r=parseInt(t.href.match(/&id=(\d+)/)[1]),n=t.innerHTML;return new W(r,n)}function J(e){let t=new O,r=D.troopTypesOnWorld();for(let n=0;n<r.length;n++)void 0!==e.cells[n]&&(t[r[n]]=parseInt(e.cells[n].innerHTML));return t}function Z(e){let[,t]=e.href.match(/&id=(\d+)/),[,r,n]=e.innerHTML.match(/\((\d+)\|(\d+)\)(?!.*\(.*?\))/);return new o(parseInt(t),parseInt(r),parseInt(n))}function X(e){for(var t=document.createElement("tr"),r=1;r<e.cells.length;r++)t.appendChild(document.createElement("td")),t.cells[r-1].innerHTML=e.cells[r].innerHTML;return t}class ee{constructor(e){this.gameDoc=e,this.$gameDoc=$(e),this.mainTable=this.$gameDoc.find("#attack_luck").parents("table")[0],this.luckTable=e.getElementById("attack_luck"),this.attackerTable=e.getElementById("attack_info_att"),this.attackerUnitsTable=e.getElementById("attack_info_att_units"),this.defenderTable=e.getElementById("attack_info_def"),this.defenderUnitsTable=e.getElementById("attack_info_def_units"),this.resultsTable=e.getElementById("attack_results"),this.supportKilledTable=e.getElementById("attack_away_units"),this._validate()}_validate(){let e=["mainTable","luckTable","attackerTable","attackerUnitsTable","defenderTable"];for(let t of e)if(!this[t])throw Error(`BattleReportScraper failed: couldn't locate the ${t}`)}scrapeReport(){let e=new z;return e.attacker=this.getAttacker(),e.attackerLosses=this.getAttackerLosses(),e.attackerQuantity=this.getAttackerQuantity(),e.attackerVillage=this.getAttackerVillage(),e.battleTime=this.getBattleTime(),e.buildingLevels=this.getBuildingLevels(),e.catDamage=this.getCatDamage(),e.defender=this.getDefender(),e.defenderLosses=this.getDefenderLosses(),e.defenderQuantity=this.getDefenderQuantity(),e.defenderVillage=this.getDefenderVillage(),e.dotColor=this.getDotColor(),e.espionageLevel=this.getEspionageLevel(),e.haul=this.getHaul(),e.loyalty=this.getLoyalty(),e.luck=this.getLuck(),e.morale=this.getMorale(),e.ramDamage=this.getRamDamage(),e.reportId=this.getReportId(),e.resources=this.getResources(),e.unitsOutside=this.getUnitsOutside(),e.unitsInTransit=this.getUnitsInTransit(),e.attackerSurvivors=e.attackerQuantity.subtract(e.attackerLosses),e.defenderQuantity&&(e.defenderSurvivors=e.defenderQuantity.subtract(e.defenderLosses)),e.buildingLevels||!e.ramDamage&&!e.catDamage||(e.buildingLevels=new C("?"),e.ramDamage&&(e.buildingLevels.wall=e.ramDamage.levelAfter),e.catDamage&&(e.buildingLevels[e.catDamage.buildingType]=e.catDamage.levelAfter)),e}getAttacker(){return K(this.attackerTable.rows[0].cells[1])}getAttackerLosses(){return J(X(this.attackerUnitsTable.rows[2]))}getAttackerQuantity(){return J(X(this.attackerUnitsTable.rows[1]))}getAttackerVillage(){return Z(this.attackerTable.rows[1].cells[1].firstChild.firstChild)}getBattleTime(){return Y($(this.mainTable.rows[1].cells[1]).text(),window.game_data.market)}getBuildingLevels(){if(this.getEspionageLevel()<2)return null;let e=new C,t=JSON.parse(this.$gameDoc.find("#attack_spy_building_data").val());for(let r of t)e[r.id]=parseInt(r.level);return e}getCatDamage(){if(!this.resultsTable)return null;var e=this.resultsTable.getElementsByTagName("th");let t=s.first(e,"report.catDamage");if(!t)return null;let r=t.parentNode.cells[1],n=s.buildingType(r),i=r.getElementsByTagName("b");return{buildingType:n,levelBefore:parseInt(i[0].innerHTML),levelAfter:parseInt(i[1].innerHTML)}}getDefender(){return K(this.defenderTable.rows[0].cells[1])}getDefenderLosses(){return this.defenderUnitsTable?J(X(this.defenderUnitsTable.rows[2])):null}getDefenderQuantity(){return this.defenderUnitsTable?J(X(this.defenderUnitsTable.rows[1])):null}getDefenderVillage(){return Z(this.defenderTable.rows[1].cells[1].firstChild.firstChild)}getDotColor(){return $(this.mainTable.rows[0].cells[1]).find('img[src*="dots/"]').attr("src").match(/dots\/(.+).png/)[1]}getEspionageLevel(){var e=this.$gameDoc.find("#attack_spy_resources").length>0,t=this.$gameDoc.find("#attack_spy_building_data").length>0,r=this.$gameDoc.find("#attack_spy_away").length>0;return Number(Number(e)+Number(t)+Number(r))}getHaul(){if(!this.resultsTable)return null;var e=this.resultsTable.getElementsByTagName("th");let t=s.first(e,"report.haul");return t?G(t.parentNode.cells[1]):null}getLuck(){var e=this.luckTable.getElementsByTagName("b")[0].innerHTML;return new Number(e.substring(0,e.indexOf("%")))}getLoyalty(){if(!this.resultsTable)return null;var e=this.resultsTable.getElementsByTagName("th");let t=s.first(e,"report.loyalty");if(!t)return null;var r=t.parentNode.getElementsByTagName("b");return{before:parseInt(r[0].innerHTML),after:parseInt(r[1].innerHTML)}}getMorale(){let e=this.gameDoc.getElementById("attack_moral");if(!e)return null;var t=e.getElementsByTagName("h4")[0].innerHTML;return new Number(t.substring(t.indexOf(" ")+1,t.indexOf("%")))}getRamDamage(){if(!this.resultsTable)return null;var e=this.resultsTable.getElementsByTagName("th");let t=s.first(e,"report.ramDamage");if(!t)return null;var r=t.parentNode.getElementsByTagName("b");return{levelBefore:parseInt(r[0].innerHTML),levelAfter:parseInt(r[1].innerHTML)}}getReportId(){return parseInt(this.gameDoc.URL.match(/view=(\d+)/)[1])}getResources(){let e=this.$gameDoc.find("#attack_spy_resources").find("td")[0];return e?G(e):null}getSupportKilled(){if(!this.supportKilledTable)return[];let e=[];for(let t of this.supportKilledTable.rows){let r=J(X(t)),n=Z(t.cells[0].firstChild);e.push(new Q(r,n))}return e}getUnitsInTransit(){var e=this.gameDoc.getElementsByTagName("h4");let t=s.first(e,"report.unitsInTransit");return t?J(t.nextSibling.nextSibling.rows[1]):null}getUnitsOutside(){return this.getEspionageLevel()<3?null:J(this.$gameDoc.find("#attack_spy_away").find("table")[0].rows[1])}}let te={SENT_VIA_FA:1,CONTAINS_SNOB:2,CONTAINS_KNIGHT:4,SIZE_SMALL:8,SIZE_MEDIUM:16,SIZE_LARGE:32,CONTAINS_SPY:64},re=[[5001,te.SIZE_LARGE],[1001,te.SIZE_MEDIUM],[1,te.SIZE_SMALL]],ne=new Map([[te.SENT_VIA_FA,{src:a.a.attackSentViaFa,description:"Looting attack"}],[te.SIZE_SMALL,{src:a.a.attackSizeSmall,description:"Small attack (1-1000 troops)"}],[te.SIZE_MEDIUM,{src:a.a.attackSizeMedium,description:"Medium attack (1000-5000 troops)"}],[te.SIZE_LARGE,{src:a.a.attackSizeLarge,description:"Large attack (5000+ troops)"}],[te.CONTAINS_SNOB,{src:a.a.attackContainsSnob,description:"Contains Nobleman"}],[te.CONTAINS_SPY,{src:a.a.attackContainsSpy,description:"Contains Scouts"}],[te.CONTAINS_KNIGHT,{src:a.a.attackContainsKnight,description:"Contains Paladin"}]]);class ie{constructor(e=0){this.mask=e}getIcons(){let e=[];for(let[t,r]of ne)this.mask&t&&e.push(r);return e}getMask(){return this.mask}setSentViaFa(){this.mask|=te.SENT_VIA_FA}setContainsSnob(){this.mask|=te.CONTAINS_SNOB}setContainsSpy(){this.mask|=te.CONTAINS_SPY}setContainsKnight(){this.mask|=te.CONTAINS_KNIGHT}setSizeSmall(){this.mask|=te.SIZE_SMALL}setSizeMedium(){this.mask|=te.SIZE_MEDIUM}setSizeLarge(){this.mask|=te.SIZE_LARGE}static fromTroopCounts(e,t=!1){let r=0;if(t&&(r|=te.SENT_VIA_FA),e.snob>0&&(r|=te.CONTAINS_SNOB),e.knight>0&&(r|=te.CONTAINS_KNIGHT),e.spy>0&&(r|=te.CONTAINS_SPY),!t){let t=e.sum();for(let[e,n]of re)if(t>=e){r|=n;break}}return new ie(r)}}class se{scrapeIcons(e){let t=new ie;for(let r of e)r.src.includes("command/farm.png")?t.setSentViaFa():r.src.includes("command/snob.png")?t.setContainsSnob():r.src.includes("command/spy.png")?t.setContainsSpy():r.src.includes("command/knight.png")?t.setContainsKnight():r.src.includes("command/attack_small.png")?t.setSizeSmall():r.src.includes("command/attack_medium.png")?t.setSizeMedium():r.src.includes("command/attack_large.png")&&t.setSizeLarge();return t}}class ae{constructor(e){this.reportRenamer=e,this.attackIconsScraper=new se}scrapeReports(e){let t=[];for(var r=1;r<e.rows.length-1;r++){let n=this.scrapeReport(e.rows[r]);t.push(n)}return t}scrapeReport(e){let t=e.cells[1].getElementsByTagName("a")[0],r=t.getElementsByTagName("span")[0].innerHTML,n=[...e.cells[1].getElementsByTagName("img")],i=this.reportRenamer.parseName(r);return i.reportId=parseInt(t.href.match(/view=(\d+)/)[1]),i.dotColor=n.find(e=>e.src.includes("graphic/dots/")).src.match(/dots\/(.+).png/)[1],i.isForwarded=!!n.find(e=>e.src.includes("graphic/forwarded.png")),i.isNew=$(e.cells[1]).text().trim().endsWith(s.t("report.unread")),i.strTimeReceived=e.cells[2].innerHTML,i.haulStatus=this.determineHaulStatus(n),i.attackIcons=this.attackIconsScraper.scrapeIcons(n),i}determineHaulStatus(e){let t=e.find(e=>e.src.includes("graphic/max_loot/"));return t?t.src.includes("max_loot/0.png")?l.HAUL_STATUS_PARTIAL:l.HAUL_STATUS_FULL:l.HAUL_STATUS_UNKNOWN}}let le={spear:4,sword:5,axe:1,archer:5,spy:1,light:5,marcher:6,heavy:23,ram:4,catapult:12,knight:40,snob:200,militia:4},oe={spear:1,sword:2,axe:4,archer:2,spy:2,light:13,marcher:12,heavy:15,ram:8,catapult:10,knight:20,snob:200,militia:1};var de=r(3);function ce(e,t){var r=e.getElementById("attack_luck").parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;if(e.getElementById("attack_info_def_units")){var n=e.getElementById("attack_info_def_units");let r=n.rows[n.rows.length-1],i=n.insertRow(-1);i.className="center",i.insertCell(-1),i.cells[0].innerHTML="Survivors:",i.cells[0].align="left";for(let e of D.troopTypesOnWorld()){if(i.cells.length>=r.cells.length)break;let n=i.insertCell(-1),s=t.defenderSurvivors[e];0===s&&(n.className="hidden"),n.innerHTML=s}}if(e.getElementById("attack_info_att_units")){var i=e.getElementById("attack_info_att_units");let r=i.rows[i.rows.length-1],n=i.insertRow(-1);n.className="center",n.insertCell(-1),n.cells[0].innerHTML="Survivors:",n.cells[0].align="left";for(let e of D.troopTypesOnWorld()){if(n.cells.length>=r.cells.length)break;let i=n.insertCell(-1),s=t.attackerSurvivors[e];0===s&&(i.className="hidden"),i.innerHTML=s}}if(t.espionageLevel>=2){let r=t.calcPopulation(),n=3===t.espionageLevel?"Idle":"Unknown";$(e).find("#attack_spy_buildings_right").after(`\n                        <table>\n                            <tr>\n                                <th>Population:</th>\n                                <td>\n                                    Buildings <b>(${r.buildings})</b>\n                                    <br/>Military <b>(${r.troops})</b>\n                                    <br/>${n} <b>(${r.idle})</b>\n                                </td>\n                            </tr>\n                        </table>\n                    `)}if(t.loyalty){let r=U.newServerDate(),n=function(e,t,r,n,i){e<=0&&(e=25);let s=y.get("speed"),a=(r-t)/36e5,l=Math.min(100,Math.floor(e+a*s)),o=i.distanceTo(n),d=D.travelDuration("snob",o)/36e5;return{loyaltyNow:l,loyaltyAtArrival:Math.min(100,Math.floor(l+d*s))}}(t.loyalty.after,t.battleTime,r,game_data.village,t.defenderVillage);var l=e.getElementById("attack_results").getElementsByTagName("th"),o=s.first(l,"report.loyalty").parentNode,d=o.cells[1].innerHTML;o.removeChild(o.cells[1]),o.insertCell(-1),o.cells[1].innerHTML=d,o.cells[1].innerHTML+='<br/><span title="the current predicted loyalty, based on time passed since this report">@Current Time: '+n.loyaltyNow+"</span>",o.cells[1].innerHTML+='<br/><span title="the predicted loyalty at time of arrival, should you send a nobleman from your current village right now">@Arrival: '+n.loyaltyAtArrival+"</span>"}var c=e.getElementById("attack_info_att").insertRow(-1),u=document.createElement("th");u.innerHTML="ODD:",c.appendChild(u),c.insertCell(-1),c.cells[1].innerHTML=`The defender gained ${function(e){let t=0;for(let[r,n]of Object.entries(e))void 0!==oe[r]?t+=oe[r]*n:console.warn(`Couldn't determine ODD score for ${r}`);return t}(t.attackerLosses)} points.`;var h=e.getElementById("attack_info_def").insertRow(-1),p=document.createElement("th");p.innerHTML="ODA:",h.appendChild(p),h.insertCell(-1),t.defenderQuantity?h.cells[1].innerHTML=`The attacker gained ${function(e){let t=0;for(let[r,n]of Object.entries(e))void 0!==le[r]?t+=le[r]*n:console.warn(`Couldn't determine ODA score for ${r}`);return t}(t.defenderLosses)} points.`:h.cells[1].innerHTML="Not enough information.";let g=t.calcTimingInfo();r.rows||(r=r.getElementsByTagName("table")[1]);var b=r.insertRow(2);b.insertCell(-1),b.cells[0].innerHTML='<span title="the time the attacker sent the attack">Launched</span>',b.insertCell(-1),b.cells[1].innerHTML=g.launchTime.toHtml();let f=!t.attackerSurvivors.isZero();var w=r.insertRow(3);w.insertCell(-1),f&&(w.cells[0].innerHTML='<span title="the time the attacking troops return to the attacker\'s village">Returns</span>',w.insertCell(-1),w.cells[1].innerHTML=g.returnTime.toHtml());let _=t.defender.name==game_data.player.name,v=t.loyalty&&t.loyalty.after<=0;if(_||v){let r=`<a href="${m("place",{mode:"units",village:t.defenderVillage.id})}" style="float: right;">\n                    <img title="manage troops" style="float:right; cursor:pointer;" src="${a.a.buildingIcon("place")}" />\n                </a>`;e.getElementById("attack_info_def").rows[1].cells[1].appendChild($(r)[0])}var T=r.insertRow(5);T.insertCell(-1),T.cells[0].colSpan=2,T.cells[0].innerHTML="<b>JSON</b><br/><textarea cols=50 readonly=true>"+Object(de.a)(JSON.stringify(t,null,2))+"</textarea>"}var ue={twcheese:{}};switch(game_data.market){default:ue.twcheese.Help="Help";break;case"cz":ue.twcheese.Help="Pomoc";break;case"se":ue.twcheese.Help="Hjälp";break;case"gr":ue.twcheese.Help="Βοήθεια";break;case"no":ue.twcheese.Help="Hjelp"}var he=r(2);class pe extends he.a{constructor(e){super(),this.report=e,this.raiderTroopTypes=["spear","sword","axe","archer","light","marcher","heavy"].filter(e=>D.existsOnWorld(e)),this.initStructure(),this.watchSelf(),this.applyUserConfig(),this.mayFillRallyPoint()||this.$scoutsContainer.hide()}mayFillRallyPoint(){return"uk"!==window.game_data.market}initStructure(){this.$el=$(this.createHtml().trim()),this.$raidMode=this.$el.find("#twcheese_raider_selection"),this.$haulBonus=this.$el.find("#twcheese_raider_haulBonus"),this.$period=this.$el.find("#twcheese_period"),this.$periodContainer=this.$el.find("#twcheese_periodic_options"),this.$scouts=this.$el.find("#twcheese_raider_scouts"),this.$scoutsContainer=this.$el.find("#twcheese_raider_scout"),this.$buttonSetDefault=this.$el.find(".twcheese-button-set-default");let e=this.$el.find("#twcheese_raider_units")[0];this.$raiderLinks=$(e.rows[0]).find("a"),this.$raiderTroopCounts=$(e.rows[1].cells)}createHtml(){let e=this.report,t=function(e){let t={};for(let r of I)t[r]=P(R(r),e);return t}(e.attackerVillage.distanceTo(e.defenderVillage)),r=m("place",{target:e.defenderVillage.id}),n=[];e.espionageLevel>=1&&n.push('<option value="scouted">raid scouted resources</option>'),e.espionageLevel>=2&&(n.push('<option value="predicted">raid predicted resources</option>'),n.push('<option value="periodic">periodically raid resources</option>'));let i=[],s=[],l=[];for(let e of this.raiderTroopTypes)this.mayFillRallyPoint()?i.push(`<td width="35px"><a><img src="${a.a.troopIcon(e)}"></a></td>`):i.push(`<td width="35px"><img src="${a.a.troopIcon(e)}"></td>`),s.push("<td></td>"),l.push(`<td>${window.Format.timeSpan(t[e])}</td>`);return`\n                    <table id="twcheese_raider_calculator">\n                        <tr>\n                            <td><span align="center"><h2>Raiders</h2></span></td>\n                        </tr>\n                        <tr align="center">\n                            <td>\n                                <select id="twcheese_raider_selection">\n                                    ${n.join("")}\n                                </select>\n                                <a href="${r}">&raquo; Send troops</a>\n                                <div>\n                                    Haul Bonus: <input id="twcheese_raider_haulBonus" type="text" size="5" value="0"/>%\n                                </div>\n                                <div id="twcheese_periodic_options">\n                                    Period (hours): <input id="twcheese_period" type="text" size="4" value="8"/>\n                                </div>\n                                <button class="twcheese-button-set-default">Use current selection as default</button>\n                            </td>\n                        </tr>\n                        <tr align="center">\n                            <td>\n                                <table id="twcheese_raider_units" class="vis overview_table" style="border: 1px solid">\n                                    <tr class="center">${i.join("")}</tr>\n                                    <tr class="center">${s.join("")}</tr>\n                                    <tr class="center">${l.join("")}</tr>\n                                </table>\n                            </td>\n                            <td>\n                                <table id="twcheese_raider_scout" class="vis overview_table" style="border: 1px solid">\n                                    <tr class="center">\n                                        <td width="35px">\n                                            <img src="${a.a.troopIcon("spy")}" title="Number of scouts to send when a unit icon to the left is clicked">\n                                        </td>\n                                    </tr>\n                                    <tr class="center">\n                                        <td>\n                                            <input id="twcheese_raider_scouts" type="number" size="3" value="0" min="0">\n                                        </td>\n                                    </tr>\n                                </table>\n                            </td>\n                        </tr>\n                    </table>\n                `}watchSelf(){this.$raidMode.on("change",()=>{this.updateRaiders()}),this.$haulBonus.on("input",()=>{this.updateRaiders()}),this.$period.on("input",()=>{this.updateRaiders()}),this.$scouts.on("input",()=>{w.set("ReportRaiderWidget.raidScouts",this.getScouts()),this.updateRaiders()}),this.$buttonSetDefault.on("click",()=>{w.set("ReportRaiderWidget.raidMode",this.getRaidMode()),w.set("ReportRaiderWidget.haulBonus",this.getHaulBonus()),w.set("ReportRaiderWidget.raidPeriodHours",this.getPeriod()),window.UI.SuccessMessage("Settings Saved",2e3)})}applyUserConfig(){let e=w.get("ReportRaiderWidget.haulBonus",0);this.$haulBonus.val(e);let t=w.get("ReportRaiderWidget.raidPeriodHours",8);this.$period.val(t);let r=w.get("ReportRaiderWidget.raidScouts",0);this.$scouts.val(r);let n=w.get("ReportRaiderWidget.raidMode","scouted");this.$raidMode.val(n),this.updateRaiders()}updateRaiders(){let e=this.getRaidMode(),t=this.getHaulBonus(),r=this.getPeriod(),n=this.report;if("scouted"===e){let e=n.calcRaidScouted(t);this.setRaiders(e),this.$periodContainer.hide()}else if("predicted"===e){let e=n.calcRaidPredicted(window.game_data.village,U.newServerDate(),t);this.setRaiders(e),this.$periodContainer.hide()}else if("periodic"===e){let e=n.calcRaidPeriodic(r,t);this.setRaiders(e),this.$periodContainer.show()}}setRaiders(e){let t=this.getScouts(),r=(e,r)=>b({spy:t,[e]:r},this.report.defenderVillage.id);for(let[t,n]of Object.entries(this.raiderTroopTypes)){let i=e[n];if(this.$raiderTroopCounts.eq(t).text(i),!this.mayFillRallyPoint())continue;let s=r(n,Math.round(i));this.$raiderLinks.eq(t).attr("href",s)}}getRaidMode(){return this.$raidMode.val()}getHaulBonus(){return parseFloat(this.$haulBonus.val())||0}getPeriod(){return parseFloat(this.$period.val())||0}getScouts(){return parseFloat(this.$scouts.val())||0}}class ge extends he.a{constructor(e,t){super(),this.renamer=e,this.report=t,this.initStructure(),this.watchSelf(),this.applyUserConfig()}initStructure(){this.$el=$(this.createHtml().trim()),this.$note=this.$el.find("#twcheese_note"),this.$renameButton=this.$el.find("button"),this.$autoRename=this.$el.find("#twcheese_auto_rename"),this.$namePreview=this.$el.find("#twcheese_rename_preview"),this.$availableChars=this.$el.find("#twcheese_availableCharacters")}createHtml(){let e=this.renamer,t=e.createName(this.report,"");return`\n                    <div id="twcheese_renamer" align="center">\n                        <span align="center"><h2>Renamer</h2></span>\n                        note <input id="twcheese_note" type="text"/>\n                        <button>rename</button>\n                        <input id="twcheese_auto_rename" type="checkbox" />auto rename\n                        <img id="twcheese_autoRenameInfo" src="${a.a.info}" width="13" height="13" title="automatically rename reports when the BRE is used" />\n                        <br/> characters available: <span id="twcheese_availableCharacters">${e.availableChars(t)}</span>\n                        <br/><b>Preview: </b><span id="twcheese_rename_preview">${Object(de.a)(t)}</span>\n                    </div>\n                `}watchSelf(){let e=this.renamer;this.$note.on("input",()=>{let t=e.createName(this.report,this.$note.val());this.$namePreview.text(t),this.$availableChars.text(e.availableChars(t))}),this.$renameButton.on("click",()=>{this.renamer.rename(this.report,this.$note.val())}),this.$autoRename.on("click",function(){w.set("BattleReportEnhancer.autoRename",this.checked)})}applyUserConfig(){let e=w.get("BattleReportEnhancer.autoRename",!1);this.$autoRename.prop("checked",e)}}class me extends he.a{constructor(e,t){super(),this.report=e,this.renamer=t,this.initStructure(),this.watchSelf(),this.applyUserConfig(),this.initChildWidgets()}initStructure(){this.$el=$(this.createHtml().trim()),this.$content=this.$el.find(".widget_content"),this.$toggleIcon=this.$el.find(".twcheese-toggle-icon"),this.$raiderContainer=this.$el.find(".twcheese-raider-container"),this.$renamerContainer=this.$el.find(".twcheese-renamer-container")}createHtml(){return`\n                    <div id="twcheese_show_report_tools" class="vis widget">\n                        <h4>\n                            Report Tools\n                            <img class="twcheese-toggle-icon" src="${a.a.plus}" style="float:right; cursor:pointer;">\n                        </h4>\n                        <div class="widget_content" style="display: none">\n                            <table id="twcheese_BRE_tools" border="1">\n                                <tr>\n                                    <td class="twcheese-raider-container" valign="top"></td>\n                                    <td valign="top">\n                                        ${this.createDemolitionTableHtml()}\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td class="twcheese-renamer-container" colspan="2" valign="top"></td>\n                                </tr>\n                            </table>\n                        </div>\n                    </div>\n                `}createDemolitionTableHtml(){let e=this.report;if(!e.buildingLevels)return"";if(e.buildingLevels){let t=[],r=[],n=[],i=[],s=[],l=[],o=e.suggestSiegeUnits();for(let d of E.buildingTypesOnWorld()){let c,u="wall"===d?"ram":"catapult";if("uk"==game_data.market)c='<img src="'+a.a.buildingIcon(d)+'" />';else{c='<a href="'+b({[u]:o.oneShotUpgraded[d]},e.defenderVillage.id)+'"><img src="'+a.a.buildingIcon(d)+'" /></a>'}("ram"===u?r:t).push(`<td style="width: 35px;">${c}</td>`);let h="ram"===u?l:i;("ram"===u?s:n).push(`<td>${o.oneShotScouted[d]}</td>`),h.push(`<td>${o.oneShotUpgraded[d]}</td>`)}return`\n                        <table id="twcheese_demolition_calculator">\n                            <tr>\n                                <td><span align="center"><h2>Demolition</h2></span></td>\n                            </tr>\n                            <tr>\n                                <td>\n                                    <table id="twcheese_demolition_units" class="vis overview_table" style="border: 1px solid;">\n                                        <tr class="center">\n                                            <td colspan="${t.length}">\n                                                <img src="${a.a.troopIcon("catapult")}" alt="catapults" />\n                                            </td>\n                                            <td colspan="${r.length}">\n                                                <img src="${a.a.troopIcon("ram")}" alt="rams" />\n                                            </td>\n                                        </tr>\n                                        <tr class="center">${t.join("")+r.join("")}</tr>\n                                        <tr class="center">${n.join("")+s.join("")}</tr>\n                                        <tr class="center">${i.join("")+l.join("")}<tr/>\n                                    </table>\n                                </td>\n                            </tr>\n                        </table>\n                    `.trim()}}watchSelf(){this.$toggleIcon.on("click",()=>{this.toggleCollapsed()})}applyUserConfig(){w.get("ReportToolsWidget.collapse",!1)||this.toggleCollapsed()}toggleCollapsed(){this.$content.toggle({duration:200,start:()=>{let e=this.$toggleIcon.attr("src").includes(a.a.minus);this.$toggleIcon.attr("src",e?a.a.plus:a.a.minus),w.set("ReportToolsWidget.collapse",e)}})}initChildWidgets(){new ge(this.renamer,this.report).appendTo(this.$renamerContainer),new pe(this.report).appendTo(this.$raiderContainer)}}var be={twcheese:{}};switch(game_data.market){default:be.twcheese.Building="Building";break;case"cz":be.twcheese.Building="budově";break;case"se":be.twcheese.Building="Byggnad";break;case"gr":be.twcheese.Building="Κτίριο";break;case"no":be.twcheese.Building="Bygning"}function fe(e,t=""){return`<img style="display:block; margin-left:auto; margin-right:auto" src="${e}" title="${t}">`}function we(e){return`<a href="${m("info_village",{id:e.id})}">${e.x}|${e.y}</a>`}let ye=[{key:"essential",hideable:!1,cols:[{width:120,header:"",createCellHtml(e){let t=[`<img src="${a.a.dotIcon(e.dotColor)}">`];e.haulStatus!==l.HAUL_STATUS_UNKNOWN&&t.push(`<img src="${e.haulStatusIconSrc()}">`),e.isForwarded&&t.push('<img src="graphic/forwarded.png?1">');let r=`<input name="id_${e.reportId}" type="checkbox"> ${t.join(" ")}\n                            <a href="${m("report",{mode:game_data.mode,view:e.reportId})}"> view</a>\n                        `;if(e.defenderName&&e.defenderVillage){let t=e.defenderName==game_data.player.name,n=e.loyalty&&e.loyalty.after<=0;(t||n)&&(r+=`<a href="${m("place",{mode:"units",village:e.defenderVillage.id})}">\n                                    <img title="manage troops" style="float:right; cursor:pointer;" src="${a.a.buildingIcon("place")}" />\n                                </a>`)}return r}}]},{key:"attackIcons",hideable:!0,description:"Attack icons",cols:[{width:50,header:"",createCellHtml:e=>e.attackIcons.getIcons().map(e=>`<img title="${escapeHtml(e.description)}" src="${e.src}">`).join(" ")}]},{key:"distance",hideable:!0,description:"Distance",cols:[{width:60,header:"Distance",createCellHtml:e=>e.defenderDistance(game_data.village)}]},{key:"repeatLinks",hideable:!0,description:"Links to repeat attack",cols:[{width:50,header:"Repeat",createCellHtml(e){if(e.attackerName!==game_data.player.name)return"";let t=`<a title="repeat attack, from current village" href="${m("place",{try:"confirm",type:"same",report_id:e.reportId})}"><img src="${a.a.attack}"></a>`;if(e.attackerVillage&&e.attackerVillage.id){t+=` | <a title="repeat attack, from original village" href="${m("place",{try:"confirm",type:"same",report_id:e.reportId,village:e.attackerVillage.id})}"><img src="${a.a.attack}"></a>`}return t}}]},{key:"fullSubject",hideable:!0,startHidden:!0,description:"Full subject",cols:[{width:400,header:"Subject",createCellHtml:e=>e.subject}]},{key:"note",hideable:!0,startHidden:!0,description:"Note",cols:[{width:200,header:"Note",createCellHtml:e=>e.note||""}]},{key:"attackerName",hideable:!0,description:"Attacker",cols:[{width:150,header:"Attacker",createCellHtml:e=>e.attackerName||""}]},{key:"defenderName",hideable:!0,description:"Defender",cols:[{width:150,header:"Defender",createCellHtml:e=>e.defenderName||""}]},{key:"attackerVillage",hideable:!0,description:"Attacker's village",cols:[{width:70,header:"Origin",createCellHtml:e=>e.attackerVillage?we(e.attackerVillage):""}]},{key:"defenderVillage",hideable:!0,description:"Defender's village",cols:[{width:70,header:"Target",createCellHtml:e=>e.defenderVillage?we(e.defenderVillage):""}]},{key:"feint",hideable:!0,description:"Feint",cols:[{width:50,header:"Feint",createCellHtml:e=>e.wasAttackFeint?fe("graphic/dots/grey.png?1","The attack contained only a small amount of units"):""}]},{key:"deadNoble",hideable:!0,description:"Attacking noble died",cols:[{width:50,header:"Noble",createCellHtml(e){if(!e.attackerNobleDied)return"";let t=fe(a.a.troopIcon("priest"),"An attacking nobleman died.");if(e.attackerVillage&&e.attackerName===game_data.player.name){return`<a href="${m("snob",{village:e.attackerVillage.id})}">${t}</a>`}return t}}]},{key:"loyalty",hideable:!0,description:"Loyalty reported",cols:[{width:50,header:"Loyalty",createCellHtml:e=>e.loyalty?'<span class="icon ally lead" title="Loyalty change"></span> '+e.loyalty.after:""}]},{key:"defenderSurvivors",hideable:!0,description:"Troops: Defense remaining",title:"Defense remaining",cols:D.troopTypesOnWorld().map(e=>({width:20,align:"center",header:fe(a.a.troopIcon(e)),createCellHtml(t){if(!t.defenderSurvivors)return"";return t.defenderSurvivors[e]},cssClass(t){if(!t.defenderSurvivors)return"";return 0===t.defenderSurvivors[e]?"unit-item hidden":""}}))},...E.buildingTypesOnWorld().map(function(e){return{key:"buildingLevels."+e,hideable:!0,description:be.twcheese.Building+": "+s.t(`buildings.${e}`),cols:[{width:20,align:"center",header:fe(a.a.buildingIcon(e)),createCellHtml(t){if(!t.buildingLevels)return"";let r=t.buildingLevels[e];return"?"===r?"":r},cssClass(t){if(!t.buildingLevels)return"";let r=t.buildingLevels[e];return["?",0].includes(r)?"hidden":""}}]}}),...c.TYPES.map(function(e){return{key:`resources.${e}`,hideable:!0,description:`Resources: ${{wood:"Timber",stone:"Clay",iron:"Iron"}[e]}`,cols:[{width:16,align:"center",header:fe(a.a[e]),createCellHtml:t=>t.resources?window.Format.number(t.resources[e].amount):"",cssClass:t=>t.resources&&0===t.resources[e].amount?"hidden":""}]}}),{key:"resources.sum",hideable:!0,description:"Resources: Total",cols:[{width:40,align:"center",header:"Total",createCellHtml:e=>e.resources?window.Format.number(e.resources.sum()):"",cssClass:e=>e.resources&&0===e.resources.sum()?"hidden":""}]},{key:"timelaunched",hideable:!0,description:"Time: Attack launched",cols:[{width:170,header:"Launched",createCellHtml:e=>e.timeLaunched?e.timeLaunched.toHtml(!1):""}]},{key:"strTimeReceived",hideable:!0,description:"Time: Report received",cols:[{width:140,header:"Received",createCellHtml:e=>e.strTimeReceived||""}]}],_e=new class extends Map{getHideableCategories(){return this.toArray().filter(e=>e.hideable)}toArray(){return[...this.values()]}};for(let e of ye)_e.set(e.key,e);function ve(e,t){let r=-1;for(let n of e.cells){if((r+=n.initialColSpan||n.colSpan)>=t)return n}}class Te extends he.a{constructor(e){super(),this.reports=e,this.columnIndexes=new Map,this.initStructure(),this.$el.resizable(),this.watchSelf()}initStructure(){var e=document.createElement("div");e.id="twcheese_reportsFolderDisplay",e.style.overflow="hidden",e.style.position="relative",e.style.width="646px",e.style.height="400px",e.style.minHeight="100px",e.style.minWidth="100px";var t=document.createElement("div");e.appendChild(t),t.style.overflow="hidden";var r=document.createElement("table");t.appendChild(r),r.style.tableLayout="fixed",r.style.width="2370px",r.id="twcheese_reportsTable_header",r.insertRow(-1),r.insertRow(-1),r.insertRow(-1);let n=0;for(let e of _e.values()){let t=document.createElement("th");t.innerHTML=e.title||"",t.initialColSpan=e.cols.length,t.colSpan=e.cols.length,r.rows[1].appendChild(t);let i=0,s=[];for(let t of e.cols){let e=document.createElement("th");e.style.width=t.width+"px",e.style.paddingTop=0,e.style.paddingBottom=0,r.rows[0].appendChild(e);let a=document.createElement("th");a.innerHTML=t.header,r.rows[2].appendChild(a),i+=t.width,s.push(n),n++}let a=2*(e.cols.length-1);t.style.width=i+a+"px",this.columnIndexes.set(e.key,s)}var i=document.createElement("div");e.appendChild(i),i.style.overflow="hidden",i.style.height=Number(380-t.clientHeight)+"px",i.style.width="646px",i.id="twcheese_reportsTable";var s=document.createElement("table");i.appendChild(s),s.style.tableLayout="fixed",s.style.width="2370px",s.id="twcheese_reportsTable_body",s.className="vis",s.insertRow(-1);for(let e of r.rows[0].cells){let t=s.rows[0].insertCell(-1);t.style.width=e.style.width,t.style.paddingTop=0,t.style.paddingBottom=0}var a=document.createElement("div");a.id="twcheese_reportsDisplay_yScrollPanel",e.appendChild(a),a.style.overflowY="scroll",a.style.overflowX="hidden",a.style.background="transparent",a.style.position="absolute",a.style.right=0,a.style.scrollbarWidth="thin";var l=document.createElement("div");l.id="twcheese_reportsDisplay_y-table-emulator",a.appendChild(l),l.style.overflow="hidden",l.style.position="relative",l.innerHTML="&nbsp;";var o=document.createElement("div");o.id="twcheese_reportsDisplay_xScrollPanel",e.appendChild(o),o.style.height="40px",o.style.width="calc(100% - 18px)",o.style.marginTop="-23px",o.style.overflowX="scroll",o.style.overflowY="hidden",o.style.marginTop="expression('0px')",o.style.height="expression('17px')";var d=document.createElement("div");d.id="twcheese_reportsDisplay_x-table-emulator",o.appendChild(d),d.style.width=r.clientWidth+"px",d.innerHTML="&nbsp;",this.$el=$(e),this.$head=this.$el.find("#twcheese_reportsTable_header"),this.$body=this.$el.find("#twcheese_reportsTable_body"),this.$bodyPane=this.$el.find("#twcheese_reportsTable"),this.$xBodyEmulator=this.$el.find("#twcheese_reportsDisplay_x-table-emulator"),this.$yBodyEmulator=this.$el.find("#twcheese_reportsDisplay_y-table-emulator"),this.$xScrollPanel=this.$el.find("#twcheese_reportsDisplay_xScrollPanel"),this.$yScrollPanel=this.$el.find("#twcheese_reportsDisplay_yScrollPanel")}afterInsert(){let e=this.$head.parent();this.$yScrollPanel.css({top:e.outerHeight()+2}),this.populateReportsTable(),this.applySettings()}watchSelf(){this.$el.on("resize",e=>{this.fitDisplayComponents(),w.set("ReportListWidget.size.width",this.$el.width()),w.set("ReportListWidget.size.height",this.$el.height())}),this.$bodyPane.on("scroll",e=>{this.$xScrollPanel.scrollTop(this.$bodyPane.scrollTop())}),this.$yScrollPanel.on("scroll",e=>{this.$bodyPane.scrollTop(this.$yScrollPanel.scrollTop())}),this.$xScrollPanel.on("scroll",e=>{this.$bodyPane.scrollLeft(this.$xScrollPanel.scrollLeft()),this.$head.parent().scrollLeft(this.$xScrollPanel.scrollLeft())}),this.$bodyPane.on("wheel",e=>{e.preventDefault();let t=90*Math.sign(e.originalEvent.deltaY),r=performance.now(),n=0,i=()=>{let e=performance.now()-r,s=t*Math.min(1,e/250)-n;n+=s,this.$yScrollPanel[0].scrollTop+=s,this.$bodyPane[0].scrollTop+=s,e<250&&window.requestAnimationFrame(i)};window.requestAnimationFrame(i)})}populateReportsTable(){let e=new Set(["essential","attackIcons","repeatLinks","distance","fullSubject","strTimeReceived"]),t=_e.toArray().reduce(function(t,r){return"fullSubject"!==r.key&&e.has(r.key)?t:t+r.cols.length},0);for(let r of this.reports.values()){let n=this.$body[0].insertRow(-1);n.twcheeseReport=r;let i=r.attackerName&&r.defenderName&&r.attackerVillage&&r.defenderVillage;for(let s of _e.values())if(i||e.has(s.key))for(let e of s.cols){let a=n.insertCell(-1);a.innerHTML=e.createCellHtml(r),"string"==typeof e.align&&(a.style.textAlign=e.align),"function"==typeof e.cssClass&&(a.className=e.cssClass(r)),i||"fullSubject"!==s.key||(a.initialColSpan=t,a.colSpan=a.initialColSpan)}}this.alignForTroops(),this.alignForResources(),this.adjustScrollbars()}applySettings(){for(let e of _e.values())w.get(`ReportListWidget.showCols.${e.key}`,!e.startHidden)||this.hideColumns(e.key);this.$el.css({width:w.get("ReportListWidget.size.width","720px"),height:w.get("ReportListWidget.size.height","250px")}),this.fitDisplayComponents(),this.adjustScrollbars()}adjustScrollbars(){this.$xBodyEmulator.width(this.$body.width()),this.$yBodyEmulator.height(this.$body.height())}toggleReportsColumns(e){let t=_e.get(e).startHidden,r=`ReportListWidget.showCols.${e}`,n=!w.get(r,!t);w.set(r,n);for(let t of this.columnIndexes.get(e))n?this.showColumn(t):this.hideColumn(t);this.adjustScrollbars()}hideColumns(e){for(let t of this.columnIndexes.get(e))this.hideColumn(t)}showColumn(e){var t=this.$body[0],r=this.$head[0],n=r.style.width.split("px")[0];let i=ve(r.rows[0],e),s=i.style.width.split("px")[0];n=parseFloat(n)+parseFloat(s),r.style.width=n+"px",i.style.display="table-cell",ve(r.rows[1],e).style.display="table-cell",r.rows[2].cells[e].style.display="table-cell",t.style.width=n+"px";for(let r of t.rows){let t=ve(r,e);t.initialColSpan&&t.initialColSpan>1?t.colSpan+=1:t.style.display="table-cell"}}hideColumn(e){var t=this.$body[0],r=this.$head[0],n=r.style.width.split("px")[0];let i=ve(r.rows[0],e),s=i.style.width.split("px")[0];n=parseFloat(n)-parseFloat(s),r.style.width=n+"px",i.style.display="none",ve(r.rows[1],e).style.display="none",r.rows[2].cells[e].style.display="none",t.style.width=n+"px";for(let r of t.rows){let t=ve(r,e);t.initialColSpan&&t.initialColSpan>1?t.colSpan-=1:t.style.display="none"}}getSelectedReportIds(){return this.$body.find("input:checked").toArray().map(e=>parseInt(e.name.match(/\d+/)[0]))}refreshContents(){this.$body.find("tr:not(:first)").remove(),this.populateReportsTable(),this.applySettings()}fitDisplayComponents(){let e=this.$el.height()-67;this.$bodyPane.css({width:this.$el.width(),height:e}),this.$yScrollPanel.css({height:e})}alignForTroops(){let e=this.columnIndexes.get("defenderSurvivors"),t=Array(e.length).fill(2);for(let r=1;r<this.$body[0].rows.length;r++){let n=this.$body[0].rows[r];if(n.twcheeseReport.defenderSurvivors)for(let[r,i]of Object.entries(e)){let e=String(n.cells[i].innerHTML).length;t[r]=Math.max(e,t[r])}}this.alignCols(e,t)}alignForResources(){let e=[...this.columnIndexes.get("resources.wood"),...this.columnIndexes.get("resources.stone"),...this.columnIndexes.get("resources.iron"),...this.columnIndexes.get("resources.sum")],t=[2,2,2,2];for(let r=1;r<this.$body[0].rows.length;r++){let n=this.$body[0].rows[r];if(n.twcheeseReport.resources)for(let[r,i]of Object.entries(e)){let e=n.cells[i].innerText.length;t[r]=Math.max(e,t[r])}}this.alignCols(e,t)}alignCols(e,t){let r=0;for(let[n,i]of Object.entries(e)){let e=8*t[n];r+=e=Math.max(20,e);let s=this.$head[0].rows[0].cells[i],a=this.$body[0].rows[0].cells[i];s.style.width=e+"px",a.style.width=e+"px"}let n=6*e.length,i=r+2*(e.length-1)+n;ve(this.$head[0].rows[1],e[0]).style.width=i+"px"}selectMatchingReports(e){for(let t of this.reports.values())e(t)&&$(`input[name='id_${t.reportId}']`).prop("checked",!0)}deselectAllReports(){for(let e of this.reports.values())$(`input[name='id_${e.reportId}']`).prop("checked",!1)}}Object(de.b)(`\n            .ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }\n        \n            /* Icons\n            ----------------------------------*/\n        \n            .ui-icon {\n                display: block;\n                text-indent: -99999px;\n                overflow: hidden;\n                background-repeat: no-repeat;\n            }\n        \n            .ui-icon {\n                width: 16px;\n                height: 16px;\n            }\n            .ui-icon,\n            .ui-widget-content .ui-icon {\n                background-image: url(${a.a.jq.darkGrey});\n            }\n            .ui-widget-header .ui-icon {\n                background-image: url(${a.a.jq.black});\n            }\n            .ui-state-default .ui-icon {\n                background-image: url(${a.a.jq.grey});\n            }\n            .ui-state-hover .ui-icon,\n            .ui-state-focus .ui-icon {\n                background-image: url(${a.a.jq.darkGrey});\n            }\n            .ui-state-active .ui-icon {\n                background-image: url(${a.a.jq.darkGrey});\n            }\n            .ui-state-highlight .ui-icon {\n                background-image: url(${a.a.jq.blue});\n            }\n            .ui-state-error .ui-icon,\n            .ui-state-error-text .ui-icon {\n                background-image: url(${a.a.jq.red});\n            }\n        \n            /* Overlays */\n            .ui-widget-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n            }\n            .ui-resizable {\n                position: relative;\n            }\n            .ui-resizable-handle {\n                position: absolute;\n                font-size: 0.1px;\n                display: block;\n            }\n            .ui-resizable-disabled .ui-resizable-handle,\n            .ui-resizable-autohide .ui-resizable-handle {\n                display: none;\n            }\n            .ui-resizable-n {\n                cursor: n-resize;\n                height: 7px;\n                width: 100%;\n                top: -5px;\n                left: 0;\n            }\n            .ui-resizable-s {\n                cursor: s-resize;\n                height: 7px;\n                width: 100%;\n                bottom: -5px;\n                left: 0;\n            }\n            .ui-resizable-e {\n                cursor: e-resize;\n                width: 7px;\n                right: -5px;\n                top: 0;\n                height: 100%;\n            }\n            .ui-resizable-w {\n                cursor: w-resize;\n                width: 7px;\n                left: -5px;\n                top: 0;\n                height: 100%;\n            }\n            .ui-resizable-se {\n                cursor: se-resize;\n                width: 12px;\n                height: 12px;\n                right: 1px;\n                bottom: 1px;\n            }\n            .ui-resizable-sw {\n                cursor: sw-resize;\n                width: 9px;\n                height: 9px;\n                left: -5px;\n                bottom: -5px;\n            }\n            .ui-resizable-nw {\n                cursor: nw-resize;\n                width: 9px;\n                height: 9px;\n                left: -5px;\n                top: -5px;\n            }\n            .ui-resizable-ne {\n                cursor: ne-resize;\n                width: 9px;\n                height: 9px;\n                right: -5px;\n                top: -5px;\n            }\n        `);class ke{constructor(e){this.widget=e}shouldShowColumn(e){let t=_e.get(e).startHidden;return w.get(`ReportListWidget.showCols.${e}`,!t)}toggleColumn(e){this.widget.toggleReportsColumns(e)}getHideableColumns(){return _e.getHideableCategories().map(e=>({key:e.key,description:e.description}))}refreshDisplay(){this.widget.refreshContents()}}class Se extends he.a{constructor(e){super();var t=document.createElement("div");function r(r,n){let i=$(`<div style="white-space:nowrap"><label><input type="checkbox"> ${n}</label></div>`);i.find("input").prop("checked",e.shouldShowColumn(r)).on("click",()=>{e.toggleColumn(r)}),t.appendChild(i[0])}t.id="twcheese_reportsFolderSettings",t.style.display="none",t.style.columnWidth="200px",this.$el=$(t);for(let t of e.getHideableColumns())r(t.key,t.description)}}class $e{buildExportText(e,t,r){let n=this.buildHeader(r);for(let r of e)r.defenderVillage&&r.attackerName===game_data.player.name&&(t===$e.ATTACK_FROM_CURRENT?n+="\n"+this.buildEntryCurrentVillage(r):t===$e.ATTACK_FROM_ORIGINAL&&r.attackerVillage&&(n+="\n"+this.buildEntryOriginalVillage(r)));return n+="\n"+this.buildFooter()}urlCurrentVillage(e){return m("place",{try:"confirm",type:"same",report_id:e.reportId})}urlOriginalVillage(e){return m("place",{try:"confirm",type:"same",report_id:e.reportId,village:e.attackerVillage.id})}buildHeader(e){throw Error("not implemented")}buildEntryCurrentVillage(e){throw Error("not implemented")}buildEntryOriginalVillage(e){throw Error("not implemented")}buildFooter(){throw Error("not implemented")}}$e.ATTACK_FROM_CURRENT="current",$e.ATTACK_FROM_ORIGINAL="original";class xe extends $e{buildHeader(e){return`[b][u][size=12]${e}[/size][/u][/b]`}buildEntryCurrentVillage(e){return"[url="+this.urlCurrentVillage(e)+"]repeat attack "+e.reportId+" from ("+game_data.village.coord+") to ("+e.defenderVillage.x+"|"+e.defenderVillage.y+")[/url]"}buildEntryOriginalVillage(e){return"[url="+this.urlOriginalVillage(e)+"]repeat attack "+e.reportId+" from ("+e.attackerVillage.x+"|"+e.attackerVillage.y+") to ("+e.defenderVillage.x+"|"+e.defenderVillage.y+")[/url]"}buildFooter(){return""}}class Ce extends $e{buildHeader(e){return e}buildEntryCurrentVillage(e){return this.urlCurrentVillage(e)}buildEntryOriginalVillage(e){return this.urlOriginalVillage(e)}buildFooter(){return""}}class Ee extends $e{buildHeader(e){return['<!DOCTYPE NETSCAPE-Bookmark-file-1>\n<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">',`\n<DT><H3>${e}</H3></DT>\n<DL><P>`].join("")}buildEntryCurrentVillage(e){let t="",r=e.defenderDistance(game_data.village);return r<10&&(t="0"),'<DT><A HREF="'+this.urlCurrentVillage(e)+'" >'+t+r+" Repeat Attack "+e.reportId+" from ("+game_data.village.coord+") to ("+e.defenderVillage.x+"|"+e.defenderVillage.y+")</A></DT>"}buildEntryOriginalVillage(e){return'<DT><A HREF="'+this.urlOriginalVillage(e)+'" >Repeat Attack '+e.reportId+" from ("+e.attackerVillage.x+"|"+e.attackerVillage.y+") to ("+e.defenderVillage.x+"|"+e.defenderVillage.y+")</A></DT>"}buildFooter(){return"</P></DL>"}}class Ie extends he.a{constructor(e){super(),this.reports=e,this.defaultHeader="new cheesy attack group",this.exporters={bbcode:new xe,plainLink:new Ce,html:new Ee},this.initStructure(),this.watchSelf(),this.updateExportText()}initStructure(){this.$el=$(this.createHtml().trim()),this.$exportText=this.$el.find(".twcheese-export-text"),this.$buttonCopy=this.$el.find(".twcheese-button-copy"),this.$headerInput=this.$el.find("#twcheese_export_header"),this.$formatOptions=this.$el.find("input[name='twcheese-repeat-attack-export-format']"),this.$attackingVillageOptions=this.$el.find("input[name='twcheese-repeat-attack-export-village']")}createHtml(){return`\n                    <table id="twcheese_reportsFolderExport" style="display: none;">\n                        <td>\n                            <textarea class="twcheese-export-text" rows="10" cols="40" readonly="true" />\n                        </td>\n                        <td>\n                            <table id="twcheese_exportConfigTable">\n                                <tr>\n                                    <th>Format</th>\n                                    <th>Attacking Village</th>\n                                </tr>\n                                <tr>\n                                    <td>\n                                        <input type="radio" name="twcheese-repeat-attack-export-format" checked="true" value="bbcode"/> BBCode\n                                        <br/><input type="radio" name="twcheese-repeat-attack-export-format" value="plainLink"/> plain links\n                                        <br/><input type="radio" name="twcheese-repeat-attack-export-format" value="html"/> HTML\n                                    </td>\n                                    <td>\n                                        <input type="radio" name="twcheese-repeat-attack-export-village" checked="true" value="current"/> current village\n                                        <br/><input type="radio" name="twcheese-repeat-attack-export-village" value="original"/> original village\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td colspan="2">\n                                        Header: <input type="text" id="twcheese_export_header" value="${this.defaultHeader}" />\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td colspan="2" style="text-align: center; padding-top: 20px;">\n                                        <a class="twcheese-button-copy btn btn-default" href="#">Copy to clipboard</a>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </table>\n                `}watchSelf(){this.$headerInput.on("click",()=>{this.$headerInput.val()===this.defaultHeader&&this.$headerInput.val(""),this.updateExportText()}),this.$headerInput.on("input",e=>{this.updateExportText()}),this.$formatOptions.on("change",e=>{this.updateExportText()}),this.$attackingVillageOptions.on("change",e=>{this.updateExportText()}),this.$buttonCopy.on("click",e=>{e.preventDefault(),this.$exportText.select(),document.execCommand("copy"),window.UI.SuccessMessage("Copied to clipboard")})}updateExportText(){let e=this.$formatOptions.filter(":checked").val(),t=this.$attackingVillageOptions.filter(":checked").val(),r=this.$headerInput.val(),n=this.exporters[e].buildExportText(this.reports.values(),t,r);this.$exportText.val(n)}}class Re{constructor(e){this.widget=e}getSelectedReportIds(){return this.widget.getSelectedReportIds()}selectNew(){this.widget.selectMatchingReports(e=>e.isNew)}selectOld(){this.widget.selectMatchingReports(e=>!e.isNew)}selectAll(){this.widget.selectMatchingReports(e=>!0)}selectNone(){this.widget.deselectAllReports()}selectDotColor(e){this.widget.selectMatchingReports(t=>t.dotColor===e)}selectForwarded(){this.widget.selectMatchingReports(e=>e.isForwarded)}selectLoot(e){this.widget.selectMatchingReports(t=>t.haulStatus===e)}selectFeint(){this.widget.selectMatchingReports(e=>e.wasAttackFeint)}selectDeadNoble(){this.widget.selectMatchingReports(e=>e.attackerNobleDied)}selectLoyalty(){this.widget.selectMatchingReports(e=>null!==e.loyalty)}selectCleared(){this.widget.selectMatchingReports(e=>e.wasDefenderCleared())}selectText(e){let t=e.toLowerCase();this.widget.selectMatchingReports(e=>e.subject.toLowerCase().includes(t))}selectAttacker(e){let t=e.toLowerCase();this.widget.selectMatchingReports(e=>e.attackerName&&e.attackerName.toLowerCase().includes(t))}selectDefender(e){let t=e.toLowerCase();this.widget.selectMatchingReports(e=>e.defenderName&&e.defenderName.toLowerCase().includes(t))}selectAttackerVillage(e){let[,t,r]=e.match(/(\d+)\|(\d+)/);t=parseInt(t),r=parseInt(r),this.widget.selectMatchingReports(e=>!!e.attackerVillage&&(e.attackerVillage.x===t&&e.attackerVillage.y===r))}selectDefenderVillage(e){let[,t,r]=e.match(/(\d+)\|(\d+)/);t=parseInt(t),r=parseInt(r),this.widget.selectMatchingReports(e=>!!e.defenderVillage&&(e.defenderVillage.x===t&&e.defenderVillage.y===r))}}class Le extends he.a{constructor(e){super();var t=document.createElement("div");this.$el=$(t),t.id="twcheese_reportsSelectorBar",t.style.borderStyle="solid",t.style.borderWidth="1px";var r=document.createElement("div");t.appendChild(r),r.style.backgroundColor="rgb(193, 162, 100) !important",r.style.backgroundImage="linear-gradient(rgb(229,194,126), rgb(193,162,100))",r.style.backgroundRepeat="repeat-x",r.style.fontSize="9pt",r.style.fontWeight="700",r.innerHTML="SELECT",r.style.height="18px",r.style.paddingLeft="3px";var n=document.createElement("table");t.appendChild(n),n.className="vis",n.insertRow(-1);let i=e=>`<img style="display:block; margin-left:auto; margin-right:auto" src="${e}"/>`,s=new Map([["all",{click:()=>e.selectAll(),html:"all"}],["none",{click:()=>e.selectNone(),html:"none"}],["new",{click:()=>e.selectNew(),html:"new"}],["old",{click:()=>e.selectOld(),html:"old"}],["dotGreen",{click:()=>e.selectDotColor("green"),html:i("graphic/dots/green.png")}],["dotYellow",{click:()=>e.selectDotColor("yellow"),html:i("graphic/dots/yellow.png")}],["dotRed",{click:()=>e.selectDotColor("red"),html:i("graphic/dots/red.png")}],["dotBlue",{click:()=>e.selectDotColor("blue"),html:i("graphic/dots/blue.png")}],["forwarded",{click:()=>e.selectForwarded(),html:i("graphic/forwarded.png")}],["haulPartial",{click:()=>e.selectLoot(BattleReportCondensed.HAUL_STATUS_PARTIAL),html:i("graphic/max_loot/0.png")}],["haulFull",{click:()=>e.selectLoot(BattleReportCondensed.HAUL_STATUS_FULL),html:i("graphic/max_loot/1.png")}],["feint",{click:()=>e.selectFeint(),html:i("graphic/dots/grey.png"),tooltip:"feint"}],["deadNoble",{click:()=>e.selectDeadNoble(),html:i(a.a.troopIcon("priest")),tooltip:"dead noble"}],["loyalty",{click:()=>e.selectLoyalty(),html:'<span style="display:block; margin-left:auto; margin-right:auto" class="icon ally lead"/>',tooltip:"loyalty change"}],["cleared",{click:()=>e.selectCleared(),html:"defenseless"}]]);for(let[e,t]of s){let e=$(`<a href="#">${t.html}</a>`)[0];t.tooltip&&(e.title=t.tooltip),e.addEventListener("click",function(e){e.preventDefault(),t.click()});let r=n.rows[0].insertCell(-1);r.style.width="25px",r.style.textAlign="center",r.appendChild(e)}var l=document.createElement("table");t.appendChild(l),l.className="vis",l.insertRow(-1);let o=[{hintInput:"contains text",hintButton:"select text",use:t=>e.selectText(t),sprite:[-140,0]},{hintInput:"attacker",hintButton:"select attacking player",use:t=>e.selectAttacker(t),sprite:[-80,0]},{hintInput:"defender",hintButton:"select defending player",use:t=>e.selectDefender(t),sprite:[-80,0]},{hintInput:"origin",hintButton:"select attacking village",placeholder:"x|y",use:t=>e.selectAttackerVillage(t),sprite:[-120,0]},{hintInput:"target",hintButton:"select defending village",placeholder:"x|y",use:t=>e.selectDefenderVillage(t),sprite:[-120,0]}];for(let e of o){let t=document.createElement("input");t.type="text",t.size=10,t.value=e.hintInput,t.placeholder=e.placeholder||"";let r=!1;t.addEventListener("mousedown",function(){r||(this.value="",r=!0)});let n=$(`<a href="#" title="${e.hintButton}"></a>`).on("click",function(r){r.preventDefault(),e.use(t.value)}),i=$("<span>&nbsp;</span>").css({display:"inline-block",background:`url(graphic/bbcodes/bbcodes.png) no-repeat ${e.sprite[0]}px ${e.sprite[1]}px`,paddingLeft:0,paddingBottom:0,margin:3,width:20,height:20});n.append(i);let s=l.rows[0].insertCell(-1);s.appendChild(t),s.appendChild(n[0])}}}var Oe={twcheese:{}};switch(game_data.market){default:Oe.twcheese.noReportsSelected="You haven't selected any reports to be renamed.";break;case"cz":Oe.twcheese.noReportsSelected="Nejdříve si musíte vybrat, které zprávy přejmenovat.";break;case"se":Oe.twcheese.noReportsSelected="Du har inte valt några rapporter som skall döpas om.";break;case"gr":Oe.twcheese.noReportsSelected="Δεν έχεις επιλέξει  καμιά αναφορά για μετονομασία";break;case"no":Oe.twcheese.noReportsSelected="Du har ikke valgt hvilke rapporter som skal endres navn på."}class Pe extends he.a{constructor(e,t,r,n){super(),this.reports=e,this.renamer=t,this.reportSelector=r,this.displayConfigurer=n,this.initStructure(),this.watchSelf()}initStructure(){this.$el=$('\n                    <table class="vis">\n                        <tbody>\n                            <tr>\n                                <td>\n                                    <a class="twcheese-button-rename" href="#">&raquo; Rename</a>\n                                    <img src="/graphic/questionmark.png?1" width="13" height="13" title="rename selected reports to twCheese format">\n                                </td>\n                                <td style="textAlign: right;">Progress:</td>\n                                <td style="width: 40px;"><span id="twcheese_progress_percent">0</span>%</td>\n                                <td style="width: 136px;">(<span id="twcheese_progress_count">0</span>/<span id="twcheese_progress_count_max">0</span> reports)</td>\n                                <td>time remaining: <span id="twcheese_time_remaining">00:00</span></td>\n                            </tr>\n                        </tbody>\n                    </table>\n                '.trim()),this.$buttonRename=this.$el.find(".twcheese-button-rename"),this.$progressCount=this.$el.find("#twcheese_progress_count"),this.$targetCount=this.$el.find("#twcheese_progress_count_max"),this.$progressPercent=this.$el.find("#twcheese_progress_percent"),this.$timeRemaining=this.$el.find("#twcheese_time_remaining")}watchSelf(){this.$buttonRename.on("click",e=>{e.preventDefault(),this.massRename()})}async massRename(){let e=this.reportSelector.getSelectedReportIds(),t=e.length,r=0;if(0!==t){var n;this.$progressCount.text(0),this.$targetCount.text(t);for(let a of e){let e=performance.now();try{let l=await g(m("report",{mode:game_data.mode,view:a})),o=new ee(l).scrapeReport(),d=await this.renamer.rename(o,"");$('.quickedit[data-id="'+a+'"]').find(".quickedit-label").html(d);let c=this.reports.get(a),u=this.renamer.parseName(d);u.reportId=a,u.attackIcons=c.attackIcons,u.dotColor=c.dotColor,u.haulStatus=c.haulStatus,u.isForwarded=c.isForwarded,u.strTimeReceived=c.strTimeReceived,this.reports.set(u.reportId,u),r++,n=(performance.now()-e)*(t-r)/1e3;var i=Math.floor(n/60),s=Math.round(n-60*i);i<10&&(i="0"+i),s<10&&(s="0"+s),this.$timeRemaining.text(`${i}:${s}`),this.$progressCount.text(r),this.$progressPercent.text(Math.round(r/t*100))}catch(e){console.error("error renaming report:",e)}}this.displayConfigurer.refreshDisplay()}else window.UI.ErrorMessage(Oe.twcheese.noReportsSelected,3e3)}}class De extends he.a{constructor(e,t){super(),this.reports=e;let r=new Te(this.reports),n=new ke(r),i=new Re(r);var s=document.createElement("div");s.id="twcheese_reportsFolder",this.$el=$(s);var a=document.createElement("div");s.appendChild(a),a.id="twcheese_reportsFolderToolbar",a.currentPanel="none",a.toggleDisplayConfig=function(){"displayConfig"==this.currentPanel?(document.getElementById("twcheese_displayConfig_tab").className="",document.getElementById("twcheese_reportsFolderSettings").style.display="none",this.currentPanel="none"):(document.getElementById("twcheese_displayConfig_tab").className="selected",document.getElementById("twcheese_export_tab").className="",document.getElementById("twcheese_reportsFolderSettings").style.display="",document.getElementById("twcheese_reportsFolderExport").style.display="none",this.currentPanel="displayConfig")},a.toggleExport=function(){"exportLinks"==this.currentPanel?(document.getElementById("twcheese_export_tab").className="",document.getElementById("twcheese_reportsFolderExport").style.display="none",this.currentPanel="none"):(document.getElementById("twcheese_export_tab").className="selected",document.getElementById("twcheese_displayConfig_tab").className="",document.getElementById("twcheese_reportsFolderExport").style.display="",document.getElementById("twcheese_reportsFolderSettings").style.display="none",this.currentPanel="exportLinks")},a.innerHTML+='\n                    <table style="border-style:solid; border-width:0px;" class="vis modemenu">\n                        <tbody>\n                            <tr>\n                                <td id="twcheese_displayConfig_tab" style="border-style:solid; border-width:1px; cursor:default;" onclick="document.getElementById(\'twcheese_reportsFolderToolbar\').toggleDisplayConfig();">\n                                    <a>configure display</a>\n                                </td>\n                                <td id="twcheese_export_tab" style="border-style:solid; border-width:1px; cursor:default;" onclick="document.getElementById(\'twcheese_reportsFolderToolbar\').toggleExport();">\n                                    <a>export repeat-attack links</a>\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>',new Ie(this.reports).appendTo(a),new Se(n).appendTo(a),r.appendTo(s),new Le(i).appendTo(s),new Pe(this.reports,t,i,n).appendTo(s)}}Object(de.b)("\n            #twcheese_reportsFolder {\n                margin-bottom: 30px;\n            }\n        ");var Ne=r(7);let Ae={phases:[{type:"PhaseQuestion",internalName:"Entry",questions:[{type:"QuestionFreeForm",ask:"What's broken?",placeholderText:'e.g. "it shows wrong OD scores"',minResponseLength:10}]}]},Me=!1,Ue=!1,He=!1;let Fe=new Ne.a({});window.TwCheese.registerTool({id:"BRE",use:async function(){var e;Me||(await async function(){await Promise.all([y.ensureUpdated(),v.ensureUpdated(),_.ensureUpdated()])}(),e=document.createElement("div"),document.getElementById("content_value").insertBefore(e,document.getElementById("content_value").firstChild),e.innerHTML='BRE created by <a href="https://forum.tribalwars.net/index.php?members/28484">cheesasaurus</a>',e.style.fontSize="10px",function(e){var t=document.createElement("div");t.style.textAlign="center";var r=document.createElement("p");r.style.fontSize="9pt",r.innerHTML=ue.twcheese.Help,r.style.fontWeight="700",r.style.marginTop="3px",r.style.color="#422301",t.appendChild(r),t.style.background=`url("${a.a.legacy.helpBackground}")`,t.style.height="22px",t.style.width="49px",t.style.display="block",t.style.position="fixed",t.style.left="100%",t.style.top="100%",t.style.marginTop="-24px",t.style.marginLeft="-52px",t.style.zIndex="99999999999",t.onmouseover=function(){this.style.background=`url("${a.a.legacy.helpBackgroundBright}")`},t.onmouseout=function(){this.style.background=`url("${a.a.legacy.helpBackground}")`},e?(t.style.cursor="pointer",t.onclick=function(){window.open(e,"twcheese_menu_window")}):t.style.cursor="default",document.body.appendChild(t)}("https://forum.tribalwars.net/index.php?threads/256225/"),Me=!0),"report"==game_data.screen&&document.URL.includes("&view=")?Ue||(function(){let e=new ee(document).scrapeReport(),t=new H;$(t).on("report-renamed",function(e){$('.quickedit[data-id="'+e.reportId+'"]').find(".quickedit-label").html(e.newName)}),w.get("BattleReportEnhancer.autoRename",!1)&&t.rename(e,""),ce(document,e),new me(e,t).insertBefore($("#content_value").find("h2").eq(0))}(),Ue=!0):"report"!=game_data.screen||"attack"!=game_data.mode&&"defense"!=game_data.mode?alert('try using this on:\n1) a battle report\n2) a reports folder, with the "Attacks" filter on\n3) a reports folder, with the "Defenses" filter on'):He||(function(){let e=new H,t=document.getElementById("report_list"),r=t.parentNode,n=new ae(e),i=new Map;for(let e of n.scrapeReports(t))i.set(e.reportId,e);r.removeChild(t),new De(i,e).insertBefore(r.firstChild)}(),He=!0)},getDebugProcess:function(){return Fe.create("Tool: Battle Report Enhancer",Ae,!0)}})},function(e,t,r){"use strict";r.r(t);var n=r(2),i=r(3),s=r(1),a=r(5),l=r(4);class o extends n.a{constructor(e){super(),this.question=e,this.initStructure(e),this.watchSelf()}initStructure(){this.$el=$(this.createHtml().trim()),this.$answers=this.$el.find(".twcheese-debug-question-answer")}createHtml(){let e=[];for(let t=0;t<this.question.options.length;t++){let r=this.question.options[t];e.push(`\n                        <div class="twcheese-debug-question-answer ${r.className}" data-index="${t}">\n                            ${r.text}\n                        </div>\n                    `)}switch(this.question.getType()){case l.a.FREE_FORM:return this._createHtmlQuestionFreeForm();case l.a.VALUE:return this._createHtmlQuestionAboutValue(e);case l.a.SELECT:return this._createHtmlQuestionSelect(e);default:throw Error("unrecognized question type")}}_createHtmlQuestionSelect(e){return`\n                    <div class="twcheese-debug-question">\n                        <div class="twcheese-debug-question-text">${this.question.text}</div>\n                        <hr/>\n                        ${e.join("")}\n                    </div>\n                `}_createHtmlQuestionFreeForm(){let e=this.question.options[0];return`\n                    <div class="twcheese-debug-question">\n                        <div class="twcheese-debug-question-text">${this.question.text}</div>\n                        <hr/>\n                        <textarea\n                            placeholder="${Object(i.a)(e.text)}"\n                            class="twcheese-debug-question-answer ${e.className}"\n                            data-index="0"\n                        >${Object(i.a)(e.value)}</textarea>\n                    </div>\n                `}_createHtmlQuestionAboutValue(e){let t=this.createHtmlForValue(this.question.value);return`\n                    <div class="twcheese-debug-question">\n                        <div class="twcheese-debug-question-text">${this.question.text}</div>\n                        <hr/>\n                        <div class="twcheese-debug-question-content">\n                            <div class="twcheese-debug-question-value">${t}</div>\n                            <div style="padding-left: 10px;">${e.join("")}</div>\n                        </div>                \n                    </div>\n                `}createHtmlForValue(e){return null==e?'<span class="non-existent">non-existent</span>':"function"==typeof e.toDebugString?Object(i.a)(e.toDebugString()):"object"==typeof e?Object.entries(e).map(e=>{let[t,r]=e;return`<div class="twcheese-debug-value-iter">\n                            <div class="key">${this.createLabelForValue(r,t)}</div>\n                            <div class="value">${this.createHtmlForValue(r)}</div>\n                        </div>`}).join(""):Object(i.a)(e.toString())}createLabelForValue(e,t){return"function"==typeof e.imageSrc?`<image src="${e.imageSrc()}" />`:t}watchSelf(){this.question.getType()!==l.a.FREE_FORM?this.$answers.on("click",e=>{this.$answers.removeClass("active");let t=$(e.target).addClass("active");this.question.setSelectedOption(t.data("index"))}):this.$answers.on("input",e=>{let t=$(e.target);this.question.options[0].setValue(t.val())})}}Object(i.b)("\n            .twcheese-debug-question {\n                margin-bottom: 40px;\n            }\n        \n            .twcheese-debug-question-text {\n                font-size: 13px;\n                font-weight: 700;\n                color: rgb(200, 200, 200);\n            }\n        \n            .twcheese-debug-question hr {\n                height: 1px;\n                background-color: white;\n                border: none;\n                opacity: 0.2;\n            }\n        \n            .twcheese-debug-question-content {\n                display: flex;\n                justify-content: space-between;        \n                align-items: center;\n            }\n        \n            .twcheese-debug-question-value {\n                line-height: 20px;\n            }\n            .twcheese-debug-question-value img {\n                vertical-align: middle;\n            }\n        \n            .twcheese-debug-question-value .non-existent {\n                font-style: italic;\n            }\n        \n            .twcheese-debug-question-answer {\n                margin: 10px 0;\n                background-color: rgb(23, 23, 23);\n                border: 1px solid rgb(75, 75, 75);\n                height: 30px;\n                border-radius: 15px;\n                line-height: 30px;\n                white-space: nowrap;\n                padding: 0 10px;\n                text-align: center;\n                cursor: pointer;\n            }\n            .twcheese-debug-question-answer:hover {\n                border-color: rgb(150, 150, 150);\n            }\n            .twcheese-debug-question-answer.active {\n                border-color: darkOrange;\n                background-color: black;\n            }\n            \n            .twcheese-debug-question-answer.correct {\n                border-color: rgb(0, 70, 0);\n            }\n            .twcheese-debug-question-answer.correct:hover {\n                border-color: rgb(0, 100, 0);\n            }\n            .twcheese-debug-question-answer.correct.active {\n                border-color: rgb(0, 150, 0);\n            }\n        \n            .twcheese-debug-question-answer.incorrect {\n                border-color: rgb(100, 0, 0);\n            }\n            .twcheese-debug-question-answer.incorrect:hover {\n                border-color: rgb(175, 0, 0);\n            }\n            .twcheese-debug-question-answer.incorrect.active {\n                border-color: rgb(250, 0, 0);\n            }\n        \n            .twcheese-debug-question-answer.free-form {\n                border: 1px solid rgb(75, 75, 75);\n                border-radius: 3px;\n                white-space: pre-wrap;\n                color: inherit;\n                padding: 2px 5px;\n                text-align: left;\n                line-height: normal;\n                height: 120px;\n                width: calc(100% - 6px);\n                resize: vertical;\n                cursor: text;\n            }\n        \n            .twcheese-debug-value-iter {\n                display: flex;\n            }\n            .twcheese-debug-value-iter > div:nth-child(2) {\n                padding-left: 5px;\n            }\n        \n        ");class d extends n.a{constructor(e){super(),this.phase=e,this.initStructure(),this.watchSelf(),this.$abort.hide()}initStructure(){this.$el=$(this.createHtml().trim()),this.$abort=this.$el.find(".twcheese-debug-attempt-abort")}createHtml(){return this.phase.instructions?this.createHtmlForUserInteraction():this.createHtmlForAutoAttempt()}createHtmlForUserInteraction(){return`\n                    <div class="twcheese-debug-attempt">\n                        <p>${this.phase.instructions}</p>\n                        <div style="text-align: center;">\n                            <div class="twcheese-debug-attempt-abort">Can't do it</div>\n                        </div>\n                    </div>\n                `}createHtmlForAutoAttempt(){return`\n                    <div class="twcheese-debug-attempt">\n                        Standby for <i>${this.phase.name}</i>.\n                    </div>\n                `}watchSelf(){this.$abort.on("click",()=>this.phase.userAbort())}appendTo(e){return setTimeout(()=>this.showAbortButton(),1e4),super.appendTo(e)}showAbortButton(){this.$abort.show(),$(this).trigger("change")}}Object(i.b)("\n            .twcheese-debug-attempt-abort {\n                display: inline-block;\n                margin: 10px 0;\n                background-color: rgb(23, 23, 23);\n                border: 1px solid rgb(75, 75, 75);\n                height: 30px;\n                border-radius: 15px;\n                line-height: 30px;\n                white-space: nowrap;\n                padding: 0 10px;\n                text-align: center;\n                cursor: pointer;\n            }\n            .twcheese-debug-attempt-abort:hover {\n                border-color: rgb(150, 150, 150);\n            }   \n        ");class c extends n.a{constructor(e){super(),this.phase=e,this.initStructure(),this.watchPhase()}initStructure(){this.$el=$(this.createHtml().trim())}createHtml(){return'<div class="twcheese-debug-report"><i>Submitting report...</i></div>'}watchPhase(){$(this.phase).on(s.a.BUG_REPORT_SUCCEEDED,e=>{this.$el.html("<p>Bug reported!</p>")})}}Object(i.b)("\n            .twcheese-debug-report {\n                min-height: 200px;\n            }    \n        ");class u extends n.a{constructor(){super(),this.initStructure(),this.watchSelf(),this.watchGlobal(),this.process=null}initStructure(){this.$el=$(this.createHtml().trim()),this.$header=this.$el.find(".twcheese-debugger-header"),this.$content=this.$el.find(".twcheese-debugger-content"),this.$nav=this.$el.find(".twcheese-debugger-nav"),this.$next=this.$el.find(".twcheese-debugger-next"),this.$processName=this.$el.find(".twcheese-debugger-process-name"),this.$inspector=this.$el.find(".twcheese-debugger-inspector"),this.$iframe=this.$inspector.find("iframe"),this.$iframeOverlay=this.$inspector.find(".iframe-overlay")}createHtml(){return'\n                    <div class="twcheese-debugger">\n                        <div>\n                            <div class="twcheese-debugger-header">\n                                <div>REPORT A BUG</div>\n                                <div class="twcheese-debugger-process-name"></div>\n                            </div>\n                            <div class="twcheese-debugger-content">blah bla blucci</div>\n                            <div class="twcheese-debugger-nav">\n                                <div class="twcheese-debugger-next"></div>\n                            </div>\n                        </div>\n                        <div class="twcheese-debugger-inspector">\n                            <iframe scrolling="no"></iframe>\n                            <div class="iframe-overlay"></div>\n                        </div>\n                    </div>\n                '}watchSelf(){this.$next.on("click",()=>{this.process.goToNextPhase()})}watchGlobal(){$(window).on("resize",()=>this.updateScrolling())}startProcessForLastUsedToolIfSensible(){this.process||this.startProcess(window.TwCheese.newDebugProcess(TwCheese.lastToolUsedId))}startProcess(e){this.$next.hide(),this.process=e,this.$processName.text(e.name),$(e).on(s.a.PHASE_COMPLETION_READY,()=>{this.process.hasNextPhase()&&this.$next.show()}),$(e).on(s.a.PHASE_COMPLETION_NOT_READY,()=>{this.$next.hide()}),$(e).on(s.a.PHASE_CHANGED,()=>{this.renderCurrentPhase()}),e.start()}renderCurrentPhase(){this.$inspector.hide(),this.$content.html(""),this.process.hasNextPhase()||this.$next.hide();let e=this.process.getCurrentPhase();switch(e.getType()){case a.a.QUESTION:this._renderPhaseQuestion(e);break;case a.a.ATTEMPT:this._renderPhaseAttempt(e);break;case a.a.REPORT:this._renderPhaseReport(e);break;default:throw Error("unrecognized phase")}setTimeout(()=>this.updateScrolling(),200),$(this).trigger("change")}_renderPhaseQuestion(e){for(let t of e.questions)new o(t).appendTo(this.$content);"string"==typeof e.examinedHtml&&this.openInspector(e.examinedHtml)}_renderPhaseAttempt(e){let t=new d(e).appendTo(this.$content);$(t).on("change",()=>this.updateScrolling())}_renderPhaseReport(e){new c(e).appendTo(this.$content)}updateScrolling(){this.$content.parent(".slimScrollDiv").size()>0&&(this.$content.parent().replaceWith(this.$content),this.$content.height("auto"));let e=this.$el.innerHeight()-this.$header.outerHeight()-this.$nav.outerHeight();this.$content.slimScroll({height:Math.min(e,this.$content.outerHeight()),color:"rgb(150, 150, 150)",opacity:.3,borderRadius:0,alwaysVisible:!0})}openInspector(e){let t=this.$iframe[0].contentWindow,r=t.document;r.open(),r.write(e),r.close(),setTimeout(()=>{void 0!==t.Timing&&t.Timing.pause(),this.$inspector.show();let e=Math.min(t.document.body.scrollWidth,this.calcMaxIframeWidth());this.$iframe.css({width:e}),this.$iframeOverlay.css({width:e}),$(this).trigger("change")},200)}calcMaxIframeWidth(){return document.documentElement.clientWidth-this.$header.outerWidth()-50-40}}Object(i.b)("\n            .twcheese-debugger {\n                height: 100%;\n                display: flex;\n            }\n        \n            .twcheese-debugger a {\n                font-weight: normal;\n                font-size: 12px;\n                color: rgb(63, 156, 214);\n                text-decoration: underline;\n            }\n            .twcheese-debugger a:hover {\n                color: rgb(96, 174, 221);\n            }\n        \n            .twcheese-debugger-header {\n                background-color: rgb(56, 56, 56);\n                padding: 9px 20px;\n                font-weight: 700;\n                font-size: 14px;\n                color: rgb(200, 200, 200);\n                cursor: default;\n                min-width: 300px;\n            }\n        \n            .twcheese-debugger-process-name {\n                font-weight: normal;\n                font-size: 11px;\n                margin-top: 3px;\n                white-space: nowrap;\n            }\n        \n            .twcheese-debugger-content {\n                box-sizing: border-box;\n                padding: 20px;\n            }\n        \n            .twcheese-debugger-nav {\n                padding: 20px 10px;\n                height: 20px;\n            }\n        \n            .twcheese-debugger-next {\n                width: 0;\n                height: 0;\n                border: 10px solid transparent;\n                cursor: pointer;\n                webkit-filter: brightness(0.7);\n                filter: brightness(0.7);\n            }\n        \n            .twcheese-debugger-next {\n                border-left: 20px solid white;\n                float: right;\n            }\n        \n            .twcheese-debugger-next:hover {\n                webkit-filter: brightness(1);\n                filter: brightness(1);\n            }\n        \n            /* inspector */\n        \n            .twcheese-debugger-inspector {\n                position: relative;\n                width: 100%;\n                background-color: rgb(30, 30, 30);\n                line-height: unset;\n            }\n        \n            .twcheese-debugger-inspector iframe,\n            .twcheese-debugger-inspector .iframe-overlay {\n                width: 500px;\n                height: calc(100% - 40px);\n                margin: 20px;\n                border: none;\n                overflow: hidden;\n            }\n        \n            .twcheese-debugger-inspector .iframe-overlay {\n                position: absolute;\n                top: 0;\n                left: 0;\n                background-color: cyan;\n                opacity: 0.1;\n            }\n        \n        ");var h=r(0);class p extends n.a{constructor(){super(),this.initStructure(),this.watchSelf(),this.isExpandedVert=!1,this.activeMenuItem=null,this.contents={bugReporter:(new u).appendTo(this.$content)},this.watchContents()}initStructure(){this.$el=$(this.createHtml().trim()),this.$menuMain=this.$el.find(".menu-item.main"),this.$mainIcon=this.$menuMain.find(".icon"),this.$menuBug=this.$el.find(".menu-item.bug"),this.$menuGithub=this.$el.find(".menu-item.github"),this.$content=this.$el.find(".twcheese-sidebar-content")}createHtml(){return'\n                    <div id="twcheese-sidebar">\n                        <div class="twcheese-sidebar-menu">\n                            <div class="menu-item main"><div class="icon"></div></div>\n                            <div class="menu-item bug"><div class="icon"></div></div>\n                            <a class="menu-item github"\n                              href="https://github.com/cheesasaurus/twcheese/releases"\n                              target="_blank"\n                            ><div class="icon"></div></a>\n                        </div>\n                        <div class="twcheese-sidebar-content"></div>\n                    </div>\n                '}watchSelf(){this.$menuMain.on("click",()=>this.toggleExpand()),this.$menuBug.on("click",()=>{this.$menuBug.hasClass("active")?(this.$menuBug.removeClass("active"),this.activeMenuItem=null,this.shrinkHoriz()):(this.contents.bugReporter.startProcessForLastUsedToolIfSensible(),this.$menuBug.addClass("active"),this.activeMenuItem="bug",this.expandHoriz())})}watchContents(){$.each(this.contents,(e,t)=>{$(t).on("change",()=>{this.activeMenuItem&&this.$el.width(this.$el[0].scrollWidth)})})}async toggleExpand(){let e=this.activeMenuItem?200:0,t=200+e;this.spinMainIcon(t),this.isExpandedVert?(this.activeMenuItem&&await this.shrinkHoriz(e),this.shrinkVert(200)):(await this.expandVert(200),this.activeMenuItem&&this.expandHoriz(e))}spinMainIcon(e){$({deg:0}).animate({deg:180},{duration:e,step:e=>{this.$mainIcon.css({transform:"rotate("+e+"deg)"})}})}async expandVert(e){return this.isExpandedVert=!0,new Promise((t,r)=>{let n={duration:e,complete:()=>{this.$menuGithub.show(),t()}};this.$el.animate({height:"100%",easing:"linear"},n)})}shrinkVert(e){this.$menuGithub.hide(),this.isExpandedVert=!1,this.$el.animate({height:"50px"},e)}expandHoriz(e){let t={duration:e};this.$el.animate({width:this.$el[0].scrollWidth},t)}async shrinkHoriz(e){return new Promise((t,r)=>{let n={duration:e,complete:t};this.$el.animate({width:"50px"},n)})}}Object(i.b)(`\n            #twcheese-sidebar {\n                position: fixed;\n                display: inline-block;\n                z-index: 20000;\n                top: 0;\n                left: 0;\n                height: 50px;\n                max-height: 100%;\n                overflow-x: hidden;\n                overflow-y: hidden;\n                width: 50px;\n                max-width: 100%;\n            }\n        \n            /* menu **************************************************/\n        \n            .twcheese-sidebar-menu {\n                position: relative;\n                display: block;\n                width: 50px;\n                height: 100%;\n                background-color: rgb(51, 51, 51);\n            }\n        \n            .twcheese-sidebar-menu.expanded {\n                height: 100%;\n            }\n        \n            .twcheese-sidebar-menu .menu-item {\n                position: relative;\n                display: block;\n                box-sizing: border-box;\n                width: 50px;\n                height: 50px;\n                cursor: pointer;\n            }\n        \n            .twcheese-sidebar-menu .menu-item .icon {\n                position: absolute;\n                box-sizing: border-box;\n                position: absolute;\n                width: 50px;\n                height: 50px;\n                \n                background-size: 36px 36px;\n                background-repeat: no-repeat;\n                background-position: center;\n            }\n            \n        \n            .twcheese-sidebar-menu .menu-item.main {\n                background-color: darkOrange;\n            }\n        \n            .twcheese-sidebar-menu .menu-item.main .icon {\n                background-image: url('${h.a.sidebarMain}');\n            }\n            .twcheese-sidebar-menu .menu-item.main:hover .icon {\n                -webkit-filter: brightness(2);\n                filter: brightness(2);\n            }\n        \n            .twcheese-sidebar-menu .menu-item.bug .icon {\n                background-image: url('${h.a.sidebarBug}');\n                -webkit-filter: brightness(0.7);\n                filter: brightness(0.7);\n            }\n        \n            .twcheese-sidebar-menu .menu-item.github {\n                position: absolute;\n                display: none;\n                bottom: 0;\n                margin-top: 50px;\n            }\n        \n            .twcheese-sidebar-menu .menu-item.github .icon {\n                background-image: url('${h.a.sidebarGithub}');\n                -webkit-filter: brightness(0.7);\n                filter: brightness(0.7);\n            }\n        \n            .twcheese-sidebar-menu .menu-item:hover .icon,\n            .twcheese-sidebar-menu .menu-item.active .icon {\n                -webkit-filter: brightness(1);\n                filter: brightness(1);\n            }\n        \n            /* content  **************************************************/\n        \n            .twcheese-sidebar-content {\n                position: absolute;\n                display: block;\n                left: 50px;\n                height: 100%;\n                top: 0;\n                background-color: rgb(37, 37, 37);\n                color: rgb(187, 187, 187);\n            }\n        \n        \n        `),TwCheese.registerTool({id:"Sidebar",use:()=>{(new p).appendTo($("body"))},getDebugProcess:()=>null})}]),sidebarInitd||TwCheese.useTool("Sidebar")}TwCheese.useTool(toolId)}();